<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Polymer 1er contact le retour</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #b8eee9;
            border-radius: 0px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <h1>K33G_ORG's Blog</h1>
    <p></p>
    <a class="label label-info" href="/">home</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>Polymer : "les mains dans le cambouis", épisode 2 : Ajax</h1>

<blockquote><p><em>Nous parlerons de:</em></p>

<blockquote><ul>
<li><em>Comment faire rapidement une petite API REST avec NodeJS et Express</em></li>
<li><em>Comment faire des requêtes <code>GET</code> avec le composant <code>&lt;polymer-ajax&gt;</code></em></li>
<li><em>Comment faire des requêtes <code>POST</code> avec le composant <code>&lt;polymer-ajax&gt;</code></em></li>
</ul>
</blockquote>

<p><em>Cet article est beaucoup plus court que le précédent, mais reste incontournable si vous voulez réaliser des SPA ayant des interactions avec un serveur.</em></p></blockquote>

<h2>Pré-requis</h2>

<p>Tout d'abord, il faut avoir lu le tuto précédent : <a href="http://k33g.github.io/2013/12/07/POLYMER-1.html">http://k33g.github.io/2013/12/07/POLYMER-1.html</a>.</p>

<p>Ensuite, pour ce 2ème épisode nous aurons besoin d'un serveur qui puisse nous renvoyer du flux json et auquel nous pourrons envoyer des données (nous allons stocker notre liste côté serveur). Après réflexion (utiliser Play, utiliser SparkJava, ...), j'ai donc décidé d'aller au plus simple : utiliser <strong><a href="http://nodejs.org/">NodeJS</a></strong> et <strong><a href="http://expressjs.com/">Express</a></strong>. Je pars du principe que vous avez installé déjà installé <strong><a href="http://nodejs.org/">NodeJS</a></strong> <em>(et donc le gestionnaire de package npm)</em>.</p>

<h3>Création du serveur</h3>

<ul>
<li>en mode console, installez Express : tapez <code>sudo npm -g install express</code> (sous Windows pas besoin de <code>sudo</code>)</li>
<li>puis créez un répertoire pour votre application (dans mon cas : <code>02-ajax</code>)</li>
<li><p>dans ce répertoire (<code>cd 02-ajax</code>), créez un fichier <code>package.json</code> avec le contenu suivant</p>

<pre><code>  {
    "name": "hello-polymer",
    "description": "hello-polymer app",
    "version": "0.0.1",
    "dependencies": {
      "express": "3.x"
    }
  }
</code></pre></li>
<li><p>ensuite, tapez <code>npm install</code>, les dépendances nécessaires pour faire tourner Express vont être installées</p></li>
<li>créer ensuite (toujours dans le répertoire de votre application) un répertoire <code>public</code> dans lequel vous pouvez copier l'ensemble des fichiers de l'article précédent (<code>index.html</code>, le répertoire <code>components</code> et son contenu, et faites de même pour le répertoire <code>bower_components</code>)</li>
</ul>


<p>Vous devriez avoir l'arborescence suivante :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-011.png" alt="Alt &quot;011.png&quot;" /></p>

<h3>Création de l'application Express</h3>

<p>Rien de plus simple. Créez dans votre répertoire applicatif un fichier <code>app.js</code> avec le code suivant:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="kd">var</span> <span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Doctor No&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
<span class="p">];</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">buddies</span><span class="p">))</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">buddy</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
  <span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">buddy</span><span class="p">)</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">buddy</span><span class="p">))</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
</code></pre></div>


<p>Pour lancer notre application, il suffira de lancer <code>node app.js</code>, vous pouvez tester dès maintenant avec l'url <code>http://localhost:3000</code> dans votre navigateur, vous arriverez sur le contenu de notre page <code>index.html</code>. Si vous avez le plugin <strong>Postman</strong> pour Chrome, vous pouvez tester votre "api" dès maintenant <em>(vous pouvez aussi utilisez curl)</em>.</p>

<h4>Requête GET</h4>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-012.png" alt="Alt &quot;012.png&quot;" /></p>

<h4>Requête POST</h4>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-013.png" alt="Alt &quot;013.png&quot;" /></p>

<p>Relancez la requête <code>GET</code> :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-014.png" alt="Alt &quot;014.png&quot;" /></p>

<p>Nous avons bien un nouvel enregistrement. Notre serveur est opérationnel. Nous pouvons retourner faire du <strong>Polymer</strong>.</p>

<h2><code>&lt;buddies-list&gt;</code> appelle le serveur</h2>

<p>Alors souvenez-vous, notre "liste de copains" <code>&lt;buddies-list&gt;</code>avait le code suivant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;buddies-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;polymer-signals</span> <span class="na">on-polymer-signal-newbuddy=</span><span class="s">&quot;{{onNewBuddySignal}}&quot;</span><span class="nt">&gt;&lt;/polymer-signals&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{title}}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;template</span> <span class="na">repeat=</span><span class="s">&quot;{{buddies}}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span>{{name}}<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;buddies-list&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Title is &quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Doctor No&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
        <span class="p">];</span>
      <span class="p">},</span>
      <span class="nx">onNewBuddySignal</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Sender : &quot;</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Nous souhaitons que notre liste soit "remplie" par les infos du serveur. Pour cela nous allons utiliser le composant <code>&lt;polymer-ajax&gt;</code> (qui a été installé avec la commande <code>bower install polymer-elements</code> lors du 1er épisode)</p>

<ul>
<li>Supprimez le code de la méthode <code>ready</code></li>
<li>Dans <code>&lt;template&gt;</code> on ajoute le composant <code>&lt;polymer-ajax&gt;</code> en précisant ses attributs et callbacks</li>
<li>Dans la méthode <code>onReceive(response)</code> déclenchée une fois que nous recevons les données du serveur, on affecte les données reçues à la propriétés <code>buddies</code> du composant <em>(propriété utilisée dans le template)</em></li>
<li>Remarque : dans le tag <code>&lt;polymer-ajax&gt;</code> vous remarquerez l'attribut <code>auto</code>, qui lance automatiquement la requête.</li>
</ul>


<p>Votre code devrez ressembler à ceci :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;buddies-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;polymer-ajax</span> <span class="na">id=</span><span class="s">&quot;xhr&quot;</span> <span class="na">auto</span> <span class="na">handleAs=</span><span class="s">&quot;json&quot;</span> <span class="na">method=</span><span class="s">&quot;GET&quot;</span> <span class="na">url=</span><span class="s">&quot;buddies&quot;</span>
                  <span class="na">on-polymer-response=</span><span class="s">&quot;{{onReceive}}&quot;</span>
                  <span class="na">on-polymer-error=</span><span class="s">&quot;{{onError}}&quot;</span>
                  <span class="na">on-polymer-complete=</span><span class="s">&quot;{{onComplete}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/polymer-ajax&gt;</span>
    <span class="nt">&lt;polymer-signals</span> <span class="na">on-polymer-signal-newbuddy=</span><span class="s">&quot;{{onNewBuddySignal}}&quot;</span><span class="nt">&gt;&lt;/polymer-signals&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{title}}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;template</span> <span class="na">repeat=</span><span class="s">&quot;{{buddies}}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span>{{name}}<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;buddies-list&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

      <span class="p">},</span>
      <span class="nx">onReceive</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">onError</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*foo*/</span> <span class="p">},</span>
      <span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*foo*/</span> <span class="p">},</span>

      <span class="nx">onNewBuddySignal</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Sender : &quot;</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Si vous ouvrez votre navigateur avec l'url <a href="http://localhost:3000/">http://localhost:3000/</a>, vous devriez voir s'afficher la nouvelle liste.</p>

<p>Il ne nous reste plus qu'à gérer l'ajout de nouveaux "buddies".</p>

<h2><code>&lt;hello-john-doe&gt;</code> parle aussi au serveur</h2>

<p>Nous allons modifier notre composant <code>&lt;hello-john-doe&gt;</code> pour qu'il fasse des requêtes de type <code>POST</code> vers notre serveur (pour ajouter des "buddies" à la liste).</p>

<p>Notre code était le suivant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;hello&quot;</span><span class="nt">&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">on-click=</span><span class="s">&quot;{{clickMe}}&quot;</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">nameChanged</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">clickMe</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">&quot;CLICKED&quot;</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">asyncFire</span><span class="p">(</span>
          <span class="s1">&#39;polymer-signal&#39;</span><span class="p">,</span>
          <span class="p">{</span>
            <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;newbuddy&quot;</span><span class="p">,</span>
            <span class="nx">data</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<ul>
<li>Là aussi nous allons utiliser le composant <code>&lt;polymer-ajax&gt;</code> mais avec <code>method="POST"</code> et sans attribut <code>auto</code></li>
<li>Nous changeons la méthode <code>clickMe</code> : lorsque l'on appuie sur le bouton, on passe les informations <code>{ name : this.name }</code> au seveur par le biais d'une requête <code>POST</code>.</li>
<li>La commande <code>this.$.xhr.go();</code> sert à déclencher l'appel ajax de type <code>POST</code> au serveur <em>(où <code>xhr</code> est l'id du composant <code>&lt;polymer-ajax&gt;</code>)</em></li>
<li>Une fois la réponse du serveur obtenue, la méthode <code>onReceive</code> est déclenchée (callback), donc nous déclenchons le signal <code>"newbuddy"</code> avec <code>asyncFire()</code> <em>(cette fois ci pas besoin de passer les données, il faut juste déclencher le signal)</em>.</li>
</ul>


<p>Voici le code modifié :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;polymer-ajax</span> <span class="na">id=</span><span class="s">&quot;xhr&quot;</span> <span class="na">handleAs=</span><span class="s">&quot;json&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span> <span class="na">url=</span><span class="s">&quot;buddies&quot;</span>
                  <span class="na">on-polymer-response=</span><span class="s">&quot;{{onReceive}}&quot;</span>
    <span class="err">&lt;/</span><span class="na">polymer-ajax</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;hello&quot;</span><span class="nt">&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">on-click=</span><span class="s">&quot;{{clickMe}}&quot;</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">nameChanged</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">clickMe</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">&quot;CLICKED&quot;</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">xhrArgs</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
          <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">name</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="p">})</span>
        <span class="p">};</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">go</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">onReceive</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">asyncFire</span><span class="p">(</span>
          <span class="s1">&#39;polymer-signal&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;newbuddy&quot;</span> <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Allons juste modifier le code du composant <code>&lt;buddies-list&gt;</code> pour qu'il rafraîchisse la liste lors de l'ajout d'un élément. Pour cela il suffit de modifier dans <code>buddies-list.html</code> la méthode <code>onNewBuddySignal()</code> <em>(déclenchée par le signal "newbuddy")</em> de cette façon :</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">onNewBuddySignal</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">go</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>


<p>Avec <code>this.$.xhr.go();</code>, on appelle la requête de type <code>GET</code> du composant.</p>

<p>Il ne vous reste maintenant plus qu'à tester.</p>

<p>Vous trouverez le code de l'exemple ici : <a href="https://github.com/k33g/polymer-les-mains-dans-le-cambouis/tree/master/02-ajax">https://github.com/k33g/polymer-les-mains-dans-le-cambouis/tree/master/02-ajax</a>.</p>

<blockquote><p><em>Piste de réflexion : j'ai embarqué le composant <code>&lt;polymer-ajax&gt;</code> au sein de mes composants. Il pourrait être intéressant de les "extraire" et les rendre indépendants, et les faire communiquer avec les autres composants par l'émission et la réception de signaux</em>.</p></blockquote>

<p>Bonne lecture.</p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'Polymer 1er contact le retour';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>07 Dec 2013</span> &raquo; <a href="/2013/12/07/POLYMER-1.html">Polymer 1er contact</a></li>
            
              <li><span>29 Nov 2013</span> &raquo; <a href="/2013/11/29/BBOM.html">Le modèle objet de Backbone</a></li>
            
              <li><span>15 Nov 2013</span> &raquo; <a href="/2013/11/15/GOLO-JAVA.html">Golo et interopérabilité Java</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>