<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Le modèle objet de Backbone</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #b8eee9;
            border-radius: 0px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <h1>K33G_ORG's Blog</h1>
    <p></p>
    <a class="label label-info" href="/">home</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>Le modèle objet de Backbone est puissant, mais ATTENTION! (ceci est un cri)</h1>

<p>Je ne présente plus <a href="http://backbonejs.org/">Backbone</a>, cette petite librairie javascript MVC survitaminée. Un des aspects importants de Backbone, c'est son modèle objet que l'on peut deviner à travers ses différents composants (Model, Collection, View, Router). Ce modèle est séduisant car il nous permet de reproduire une logique <strong>"orientée classe"</strong> dans notre code javascript, mais attention les raccourcis peuvent être dangereux, car le modèle objet javascript est lui très différent d'un modèle objet tel celui de Java, .Net, etc. ... Au passage je vous conseille cette excellente lecture : <a href="http://naholyr.fr/2011/02/le-point-sur-javascript-et-heritage-prototypal/">"Le point sur Javascript et l’héritage prototypal"</a> par <a href="https://twitter.com/naholyr">Naholyr</a>.</p>

<p>Je me suis fait avoir pas plus tard qu'hier, donc voici une piqûre de rappel à travers 2 composants de Backbone (Modèles et Vues) sur quelques pièges à éviter. Les concepts sont applicables à l'ensemble des composants.</p>

<h2>Les modèles</h2>

<h3>Rappel</h3>

<p>Un modèle en Backbone est la structure de données qui va donc porter les informations. Généralement, il se définit de la façon suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Human</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

<span class="p">});</span>

<span class="kd">var</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Morane&quot;</span><span class="p">});</span>
</code></pre></div>


<p>Donc <code>bob</code> est une instance de <code>Human</code> qui lui-même <strong>"hérite"</strong> de <code>Backbone.Model</code>, et sa structure ressemble à ceci :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-01.png" alt="Alt &quot;BBOM-01.png&quot;" /></p>

<p>Nous avons passé les <code>fields</code> (<code>properties</code>) et leurs valeurs directement dans le constructeur de <code>Human</code> et maintenant nous pouvons accéder à ces propriétés de la façon suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="c1">//Qui es tu ?</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;firstName&quot;</span><span class="p">),</span> <span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">))</span>

<span class="c1">//Je veux mon nom en majuscule</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">,</span><span class="s2">&quot;MORANE&quot;</span><span class="p">)</span>

<span class="c1">//Ou bien</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;BOB&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;MORANE&quot;</span><span class="p">})</span>
</code></pre></div>


<p>Les méthodes d'instance de <code>Model</code>, donc <code>get</code> et <code>set</code> sont les équivalents de "getter" et "setter", et ils permettent d'accéder et modifier la propriété <code>attributes</code> qui contient l'ensemble des données de la structure.</p>

<h3>Le piège : les valeurs par défaut</h3>

<p>Dans les modèles Backbone, il est possible de définir des valeurs par défaut, de la façon suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Human</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">defaults</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
        <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
        <span class="nx">friends</span><span class="o">:</span><span class="p">[]</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>C'est très pratique. Vous pouvez ensuite instancier vos modèles et ajouter des <code>friends</code> à <code>bob</code>:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Morane&quot;</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">john</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">jane</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;Jane&quot;</span><span class="p">})</span>

<span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;friends&quot;</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">john</span><span class="p">,</span> <span class="nx">jane</span><span class="p">)</span>
</code></pre></div>


<p>Et là c'est le drame. Allons voir les "copains" de <code>jane</code> et de <code>john</code> (mais euh ... tu ne parlais de <code>bob</code> ?)</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-02.png" alt="Alt &quot;BBOM-02.png&quot;" /></p>

<p>Mais que s'est-il passé!? En fait, le champ <code>friends</code> est <strong>partagé</strong> entre toutes les instances!</p>

<p>Alors quand on vous dit de lire la documentation, ce n'est pas pour rien :) Mais dans ce cas là, ils auraient pu l'afficher en rouge et en gras. Sur <a href="http://backbonejs.org/#Model-defaults">http://backbonejs.org/#Model-defaults</a>, il est dit  <strong>en petit et en italique</strong> ceci :</p>

<p><em>Remember that in JavaScript, objects are passed by reference, so if you include an object as a default value, it will be shared among all instances. Instead, define defaults as a function.</em></p>

<h3>Solution</h3>

<p>Donc pour la faire simple et rapide, définissez vos valeurs par défaut avec une fonction de la manière suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Human</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">defaults</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
        <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
        <span class="nx">friends</span><span class="o">:</span><span class="p">[]</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>Et là, cela va tout de suite mieux :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-03.png" alt="Alt &quot;BBOM-03.png&quot;" /></p>

<p>Passons donc à la problématique suivante (dont les origines sont identiques) à l'aide des vues.</p>

<h2>Les vues</h2>

<p>La problématique qui va suivre est aussi valable pour les modèles, collections et routeurs mais on la trouve plus souvent dans le cas des vues.</p>

<h3>Très rapide petit rappel</h3>

<p>La vue dans Backbone (<code>Backbone.View</code>) est la structure qui va faire le lien entre vos modèles et votre affichage "HTML" dans le navigateur. ... C'est donc ... un contrôleur (<em>private joke</em>).</p>

<p>Elle se définit généralement de la manière suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Humans</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">model</span> <span class="o">:</span> <span class="nx">Human</span>
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;ul&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span>
      <span class="s2">&quot;&lt;% _.each(humans ,function(human){ %&gt;&quot;</span><span class="o">+</span>
      <span class="s2">&quot;&lt;li&gt;&lt;%= human.firstName %&gt; - &lt;%= human.lastName %&gt;&lt;/li&gt;&quot;</span><span class="o">+</span>
      <span class="s2">&quot;&lt;% }); %&gt;&quot;</span>
    <span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">renderedContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">({</span><span class="nx">humans</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">renderedContent</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])})</span>
<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</code></pre></div>


<p>Côté HTML, j'ai juste à ajouter <code>&lt;ul&gt;&lt;/ul&gt;</code> dans ma page, et le contenu de ma vue ira gentiment s'insérer au milieu.</p>

<p>Et là tout va bien :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-04.png" alt="Alt &quot;BBOM-04.png&quot;" /></p>

<h3>Le piège : encore une histoire de partage!</h3>

<p>Ce cas de figure voudrait que l'on utilise des "subviews" (une vue par modèle), comme cela chaque sous-vue possède son propre modèle d'événements, méthodes etc. ... ce qui permet d'interagir de manière unitaire sur les éléments de la liste, de ne pas être obligé de tout recharger pour rafraîchir un seul élément, etc. ... etc. ...</p>

<p>Donc notre code devrait ressembler à ceci :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">HumanItemView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">tagName</span><span class="o">:</span><span class="s2">&quot;li&quot;</span><span class="p">,</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span>
        <span class="s2">&quot;&lt;li&gt;&lt;%= firstName %&gt; - &lt;%= lastName %&gt;&lt;/li&gt;&quot;</span>
    <span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">renderedContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">renderedContent</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">el</span>  <span class="o">:</span> <span class="s2">&quot;ul&quot;</span><span class="p">,</span>
  <span class="nx">subViews</span> <span class="o">:</span> <span class="p">[],</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">HumanItemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">model</span><span class="p">}));</span>
    <span class="p">},</span><span class="k">this</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Render each child view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])})</span>
<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</code></pre></div>


<p>Donc, dans ma vue principale <code>HumansView</code> j'ai ajouté une propriété <code>subViews</code>. A l'initialisation je parcours la collection et j'instancie autant de sous-vues que de modèles.</p>

<p>Maintenant, je souhaite instancier une 2ème fois <code>HumansView</code> avec une nouvelle collection ayant un contenu différent pour pouvoir afficher un contenu de ma liste différent selon les cas :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>
<span class="kd">var</span> <span class="nx">humansView2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>

<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</code></pre></div>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-05.png" alt="Alt &quot;BBOM-05.png&quot;" /></p>

<p><strong>Arghhh!</strong> ... :) <code>subViews</code> est partagée entre toutes les instances de <code>HumansView</code>, donc les vues s'ajoutent pour toutes les instances.</p>

<h3>Solution</h3>

<p>En fait, il suffit de déclarer <code>subViews</code> dans la méthode <code>initialize</code> de cette manière :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">el</span>  <span class="o">:</span> <span class="s2">&quot;ul&quot;</span><span class="p">,</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">HumanItemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">model</span><span class="p">}));</span>
    <span class="p">},</span><span class="k">this</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Render each child view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<h3>De la même manière ...</h3>

<p>J'aimerais pouvoir afficher mes 2 instances de <code>HumansView</code> en même temps et à 2 endroits différents dans ma page HTML :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;list1&quot;</span><span class="nt">&gt;&lt;/ul&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;list2&quot;</span><span class="nt">&gt;&lt;/ul&gt;</span>
</code></pre></div>


<p>Dans ce cas là, il suffit de supprimer la référence <code>el  : "ul"</code> qui elle aussi, je le rappelle est partagée avec toutes les instances de <code>HumansView</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">HumanItemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">model</span><span class="p">}));</span>
    <span class="p">},</span><span class="k">this</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Render each child view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>Et d'instancier nos 2 vues de cette façon :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">el</span><span class="o">:</span><span class="s2">&quot;#list1&quot;</span><span class="p">,</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>
<span class="kd">var</span> <span class="nx">humansView2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">el</span><span class="o">:</span><span class="s2">&quot;#list2&quot;</span><span class="p">,</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>

<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="nx">humansView2</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</code></pre></div>


<p>Et là tout va bien :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-06.png" alt="Alt &quot;BBOM-06.png&quot;" /></p>

<h2>Conclusion</h2>

<p>Faites attention à la manière dont vous déclarez les propriétés de vos objets. Pensez d'abord à l'utilisation que vous allez en faire : le partage entre instance est aussi un aspect intéressant, mais il ne faut jamais l'oublier, car on reprend facilement des "vieux" réflexes "à la Java" qui ne fonctionnent pas forcément pareil en JavaScript.</p>

<p>J'espère que cet article servira à certains d'entre-vous.</p>

<p>Prochain épisode, nous verrons comment "détourner" le modèle objet de Backbone et se l'approprier à d'autres fins.</p>

<p>Bon WE à tous.</p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'Le modèle objet de Backbone';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>10 Dec 2013</span> &raquo; <a href="/2013/12/10/POLYMER-2.html">Polymer 1er contact le retour</a></li>
            
              <li><span>07 Dec 2013</span> &raquo; <a href="/2013/12/07/POLYMER-1.html">Polymer 1er contact</a></li>
            
              <li><span>15 Nov 2013</span> &raquo; <a href="/2013/11/15/GOLO-JAVA.html">Golo et interopérabilité Java</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>