<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Créer une application PhoneGap directement sur son smartphone Android</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #b8eee9;
            border-radius: 0px;
            padding: 10px 30px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
		<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <a class="label label-warning" href="/">K33G_ORG's Blog</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
    <a class="label label-warning" href="http://www.k33g.org/">me</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>PhoneGap "Onboard" avec Android.</h1>

<h2>Préambule</h2>

<p>Peut-on coder directement une application Android sur son smartphone, et tant que l'on y est, peut-on aussi compiler l'apk (toujours sur le smartphone) ? ...</p>

<p>La réponse est <strong>"OUI !"</strong>. Je reconnais que ce n'est pas très pratique (plus confortable sur une tablette). Quels sont les avantages réels ? Je ne sais pas trop (quoique ... pour tester une idée rapido dans le train), en tous les cas c'est très geek. Voyons donc comment faire.</p>

<p>Nous allons faire une application hybride avec PhoneGap (on peut très bien faire une "pure" application native, mais je voulais vérifier que mon idée fonctionnait de bout en bout).</p>

<h2>Pré-Requis</h2>

<p>Vous aurez besoin de</p>

<ul>
<li><strong>AIDE</strong> <a href="https://play.google.com/store/apps/details?id=com.aide.ui">https://play.google.com/store/apps/details?id=com.aide.ui</a> qui est un mini IDE "Onboard" qui permet d'éditer un projet Android et de le compiler, qui sai se connecter à un repository GIT et à un compte Dropbox. Il existe une version payante et une version free (j'ai la payante, mais normalement cela devrait fonctionner avec la free).</li>
<li>l'<strong>Android SDK</strong>, théoriquement, nous pourrions tout faire avec <strong>AIDE</strong>, vous n'avez pas besoin d'installer Eclipse et le plugin Android, juste le SDK (Pensez à mettre à jour vos variables d'environnement <code>%ANDROID_HOME%\tools;%ANDROID_HOME%\platforme-tools;</code>, où <code>ANDROID_HOME</code> est le chemin vers le répertoire d'installation du SDK).</li>
<li>le framework <strong>PhoneGap</strong> qui permet de développer facilement des applications hybrides <a href="http://phonegap.com/download">http://phonegap.com/download</a>, downloadez, dézippez, nous y reviendrons plus tard.</li>
<li>un compte <strong>Dropbox</strong> (il y a une version gratuite) <a href="http://www.dropbox.com">http://www.dropbox.com</a></li>
</ul>


<p>Si vous n'avez pas de compte Dropbox, et que vous ne souhaitez pas en avoir, vous pouvez facilement adapter ce tuto et utiliser un cable USB pour transférer vos fichiers vers votre smartphone.</p>

<h2>Création du squelette de projet Android</h2>

<ul>
<li>Allez dans votre répertoire Dropbox</li>
<li>Positionnez vous où vous voulez (à la racine de Dropbox ou dans un sous répertoire)</li>
<li>Tapez la commande : <code>android create project --target 1 --name demophonegap --path demophonegap --activity DemoPhoneGap --package org.k33g.demophonegap</code> (à adapter selon vos besoins, <code>--target</code> : la cible de compilation, 1 = par défaut, <code>--name</code> : nom du projet, <code>--path</code> : répertoire du projet, <code>--activity</code> : la classe principale de votre projet, <code>--package</code> : le package/domaine de votre projet )</li>
</ul>


<blockquote><p>Remarque : j'ai créé le projet sur mon desktop, mais <strong>AIDE</strong> peut très bien le faire directement sur votre smartphone.</p></blockquote>

<p>Maintenant, vous disposez d'un répertoire projet android que nous allons "préparer" pour qu'il fonctione avec <strong>PhoneGap</strong>.</p>

<h2>"Hybridons" notre projet Android</h2>

<ul>
<li>Dans le répertoire <code>libs</code> de votre projet android, copiez la librairie <code>cordova-2.0.0.jar</code> que vous trouvez dans le répertoire <code>\lib\android</code> du framework <strong>PhoneGap</strong>.</li>
<li>Dans le répertoire de votre projet android, créez un sous-répertoire <code>assets\www</code> dans lequel vous copierez la librairie javascript <code>cordova-2.0.0.js</code> que vous trouvez dans le répertoire <code>\lib\android</code> du framework <strong>PhoneGap</strong>.</li>
<li>Copiez le répertoire <code>xml</code> que vous trouvez dans le répertoire <code>\lib\android</code> du framework <strong>PhoneGap</strong> dans le répertoire <code>res</code> de votre projet android</li>
</ul>


<h2>Modifions DemoPhoneGap.java</h2>

<p>Ouvrez avec votre éditeur de texte préféré <code>DemoPhoneGap.java</code> (plus tard vous pourrez le faire directement sur votre smartphone), vous devez avoir le code suivant :</p>

<pre><code>package org.k33g.demophonegap;

import android.app.Activity;
import android.os.Bundle;

public class DemoPhoneGap extends Activity
{
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState)
    {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
    }
}
</code></pre>

<p>... que vous allez modifier de la façon suivante :</p>

<pre><code>package org.k33g.demophonegap;

import android.app.Activity;
import android.os.Bundle;
import org.apache.cordova.*;

public class DemoPhoneGap extends DroidGap
{
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState)
    {
        super.onCreate(savedInstanceState);
        super.loadUrl("file:///android_asset/www/index.html");
    }
}
</code></pre>

<p>... sauvegardez</p>

<p>Donc :</p>

<ul>
<li>nous avons ajouté la référence à <code>import org.apache.cordova.*;</code></li>
<li><code>DemoPhoneGap</code> hérite maintenant de <code>DroidGap</code> et non plus de <code>Activity</code></li>
<li>nous avons supprimé <code>setContentView(R.layout.main);</code> pour le remplacer par <code>super.loadUrl("file:///android_asset/www/index.html");</code>, ce qui signifie qu'au chargement de l'application, la page <code>index.html</code> sera chargée dans une UIWebview</li>
</ul>


<h2>Modifions AndroidManifest.xml</h2>

<p>Ouvrez <code>AndroidManifest.xml</code> qui est à la racine de votre projet android, et qui doit ressembler à ceci :</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
      package="org.k33g.demophonegap"
      android:versionCode="1"
      android:versionName="1.0"&gt;
    &lt;application android:label="@string/app_name" android:icon="@drawable/ic_launcher"&gt;
        &lt;activity android:name="DemoPhoneGap"
                  android:label="@string/app_name"&gt;
            &lt;intent-filter&gt;
                &lt;action android:name="android.intent.action.MAIN" /&gt;
                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;
&lt;/manifest&gt;
</code></pre>

<p>Juste avant le tag <code>&lt;application&gt;</code>, insérez ceci :</p>

<pre><code>    &lt;supports-screens 
        android:largeScreens="true" 
        android:normalScreens="true" 
        android:smallScreens="true" 
        android:resizeable="true" 
        android:anyDensity="true" /&gt;
    &lt;uses-permission android:name="android.permission.VIBRATE" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_LOCATION_EXTRA_COMMANDS" /&gt;
    &lt;uses-permission android:name="android.permission.READ_PHONE_STATE" /&gt;
    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;
    &lt;uses-permission android:name="android.permission.RECEIVE_SMS" /&gt;
    &lt;uses-permission android:name="android.permission.RECORD_AUDIO" /&gt;
    &lt;uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" /&gt;
    &lt;uses-permission android:name="android.permission.READ_CONTACTS" /&gt;
    &lt;uses-permission android:name="android.permission.WRITE_CONTACTS" /&gt;
    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt; 
    &lt;uses-permission android:name="android.permission.GET_ACCOUNTS" /&gt;
    &lt;uses-permission android:name="android.permission.BROADCAST_STICKY" /&gt;
</code></pre>

<p>Et pour le support des changements d'orientation, copiez ceci <code>android:configChanges="orientation|keyboardHidden|keyboard|screenSize|locale"</code> dans le tag <code>activity</code>.
Au final votre fichier devrait ressembler à ceci :</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
      package="org.k33g.demophonegap"
      android:versionCode="1"
      android:versionName="1.0"&gt;

        &lt;supports-screens 
            android:largeScreens="true" 
            android:normalScreens="true" 
            android:smallScreens="true" 
            android:resizeable="true" 
            android:anyDensity="true" /&gt;
        &lt;uses-permission android:name="android.permission.VIBRATE" /&gt;
        &lt;uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" /&gt;
        &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
        &lt;uses-permission android:name="android.permission.ACCESS_LOCATION_EXTRA_COMMANDS" /&gt;
        &lt;uses-permission android:name="android.permission.READ_PHONE_STATE" /&gt;
        &lt;uses-permission android:name="android.permission.INTERNET" /&gt;
        &lt;uses-permission android:name="android.permission.RECEIVE_SMS" /&gt;
        &lt;uses-permission android:name="android.permission.RECORD_AUDIO" /&gt;
        &lt;uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" /&gt;
        &lt;uses-permission android:name="android.permission.READ_CONTACTS" /&gt;
        &lt;uses-permission android:name="android.permission.WRITE_CONTACTS" /&gt;
        &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
        &lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt; 
        &lt;uses-permission android:name="android.permission.GET_ACCOUNTS" /&gt;
        &lt;uses-permission android:name="android.permission.BROADCAST_STICKY" /&gt;

    &lt;application android:label="@string/app_name" android:icon="@drawable/ic_launcher"&gt;
        &lt;activity android:name="DemoPhoneGap"
                  android:label="@string/app_name"
                  android:configChanges="orientation|keyboardHidden|keyboard|screenSize|locale"&gt;
            &lt;intent-filter&gt;
                &lt;action android:name="android.intent.action.MAIN" /&gt;
                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;
&lt;/manifest&gt;
</code></pre>

<h2>Passons à la création de la partie "applicative" en html</h2>

<p>Dans le répertoire <code>assets\www</code>, créez un fichier <code>index.html</code> avec le code suivant :</p>

<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"&gt;       
        &lt;title&gt;DEMO&lt;/title&gt;
        &lt;script type="text/javascript" charset="utf-8" src="cordova-2.0.0.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;PhoneGapDemo&lt;/h1&gt;
        &lt;p id="infos"&gt;&lt;/p&gt;

    &lt;/body&gt;
    &lt;script&gt;

        document.addEventListener("deviceready", onDeviceReady, false);
        function onDeviceReady() {
            document.querySelector("#infos").innerHTML = [
                device.name,
                device.cordova,
                device.platform,
                device.uuid,
                device.version
            ].join("&lt;br&gt;");
        }

    &lt;/script&gt;
&lt;/html&gt;
</code></pre>

<h2>Prenez votre smartphone</h2>

<ul>
<li>Lancez AIDE, à la demande de création d'un nouveau projet, faites <code>Cancel</code></li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_001.jpg" alt="Alt &quot;aide_001.jpg&quot;" /></p>

<ul>
<li>Sélectionnez "Download Dropbox Folder here ..."</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_002.jpg" alt="Alt &quot;aide_002.jpg&quot;" /></p>

<ul>
<li>Sélectionnez le répertoire <code>demophonegap</code></li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_003.jpg" alt="Alt &quot;aide_003.jpg&quot;" /></p>

<ul>
<li>Vous obtenez le contenu du répertoire <code>demophonegap</code>, Sélectionnez <code>Download</code></li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_004.jpg" alt="Alt &quot;aide_004.jpg&quot;" /></p>

<ul>
<li>Patientez pendant la synchronisation ...</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_005.jpg" alt="Alt &quot;aide_005.jpg&quot;" /></p>

<ul>
<li>Une fois la synchronisation terminée, un nouveau répertoire projet android <code>demophonegap</code> est créé sur votre smartphone</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_006.jpg" alt="Alt &quot;aide_006.jpg&quot;" /></p>

<ul>
<li>Vous pouvez même aller vérifier que vous avez bien télécharger le bon code</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_007.jpg" alt="Alt &quot;aide_007.jpg&quot;" /></p>

<ul>
<li>Allez dans le menu et sélectionnez <code>Run</code></li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_008.jpg" alt="Alt &quot;aide_008.jpg&quot;" /></p>

<ul>
<li>Vous êtes maintenant en train de compiler une vraie application android directement sur votre smartphone !!!</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_009.jpg" alt="Alt &quot;aide_009.jpg&quot;" /></p>

<ul>
<li>Une fois la compilation terminée, AIDE vous propose d'installer votre nouvelle application</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_010.jpg" alt="Alt &quot;aide_010.jpg&quot;" /></p>

<ul>
<li>C'est compilé, vous pouvez lancer votre application</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_011.jpg" alt="Alt &quot;aide_011.jpg&quot;" /></p>

<ul>
<li>Résultat :</li>
</ul>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_012.jpg" alt="Alt &quot;aide_012.jpg&quot;" /></p>

<h2>Maintenant ...</h2>

<p>Vous pouvez modifier directement votre application sur le smartphone et la compiler, tout cela sans repasser par votre desktop.
Dans notre exemple, c'est même relativement facile, puisque l'essentiel du code à modifier est du HTML et du javascript.</p>

<p>Petit conseil pour la route, si vraiment cela vous tente de code "onboard", pour la partie HTML/JS, je préfère utiliser un éditeur externe : <strong>DroidEdit</strong> <a href="https://play.google.com/store/search?q=droidedit&amp;c=apps">https://play.google.com/store/search?q=droidedit&amp;c=apps</a>, voyez vous même :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/aide_013.jpg" alt="Alt &quot;aide_013.jpg&quot;" /></p>

<h2>Conclusion ?</h2>

<p>Geekerie ? Oui, certainement, mais pratique tout de même, si vous voulez tester/vérifier quelque chose d'urgence sans ordinateur sous la main (genre, durant un trop long repas de (belle)famille ;) ).</p>

<p>Si vous connaissez d'autres outils de ce genre, j'en suis friand :)</p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'Créer une application PhoneGap directement sur son smartphone Android';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>10 May 2014</span> &raquo; <a href="/2014/05/10/ATOM-SHELL.html">Atom-shell, javascript everywhere</a></li>
            
              <li><span>09 May 2014</span> &raquo; <a href="/2014/05/09/NPM-NODE-CLI.html">Faites vos outils avec npm et node</a></li>
            
              <li><span>04 May 2014</span> &raquo; <a href="/2014/05/04/MIXIT-2014.html">MixITFR2014</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>