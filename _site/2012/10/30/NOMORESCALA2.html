<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>templates Coffeescript dans Play</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #444444;
            border-radius: 0px;
            padding: 10px 30px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
		<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <a class="label label-warning" href="/">K33G_ORG's Blog</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
    <a class="label label-warning" href="http://www.k33g.org/">me</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>Je continue à me passer des templates Scala dans Play!> 2</h1>

<blockquote><p><em>Qu'allons nous voir ?</em></p>

<ul>
<li><em>Que Coffeescript ça peut servir à quelque chose</em></li>
<li><em>rien d'autre, on fait court aujourd'hui</em></li>
</ul>
</blockquote>

<h2>Préambule</h2>

<p>C'est promis, cette fois, je vais être plus court. Restant persuadé (et ce n'est pas faute d'avoir investiguer d'autres pistes) que Play!> est le framework java web le plus facile à mettre en oeuvre (entendez par là, <em>même si tu es nul tu dois y arriver</em>), mais que je ne suis pas fait pour Scala, j'ai continué ma petite expérience de la dernière fois.</p>

<p>J'ai lu quelque part que mettre ses templates Mustache (ou autres) "inline" via des balises <code>&lt;script type="tewt/bidule"&gt;&lt;/script&gt;</code> était une hérésie (m'enfin ... c'est quand même bien pratique), que de le charger à partir d'un fichier externe via une requête ajax, ce n'était quand même pas "top" optimisé (yep ... mais là aussi c'est pratique) ... Donc, pour faire simple, je suis un gros "goret" du code.</p>

<p><strong>Mais Play!> m'a sauvé !</strong></p>

<p>Vous savez (ou pas) que Play!>2, sait aussi transpiler automatiquement du <strong>Coffeescript</strong>. Nous allons donc profiter de la fonctionnalité <strong>Block Strings</strong> de <strong>Coffeescript</strong>. Kézako ? C'est un des rêves de beaucoup de développeurs, pouvoir écrire ses p... de chaînes de caractères beaucoup trop longue sur plusieurs lignes sans être obligé de se farcir un StringBuilder à la c... (<em>En plus dêtre un goret, je suis une faignasse</em>), comme ceci par exemple :</p>

<pre><code>mySong = """

Ce soir, tu t'es couchée à neuf heures
Dans ton pti coeur c'est le bonheur
Les draps légers te carressent la raie....... des cheveux
L'immeuble avec toi c'est endormi
Seule, au troisième, une lueur luit.
Pauvre espagnol sans soleil,
Ramon Perez n'a pas sommeil

"""
</code></pre>

<p>Et là camarade insomniaque, je vois tes yeux briller ...</p>

<h2>Comment on fait ?</h2>

<p>Ce n'est pas difficile. Commencez par céer un répertoire <code>assets</code> dans le répertoire <code>app</code> de votre projet (j'oubliais : repartez du projet de l'article précédent : <a href="http://k33g.github.com/2012/10/05/NOMORESCALA.html">http://k33g.github.com/2012/10/05/NOMORESCALA.html</a>).</p>

<p>Ensuite, allez faire un tour dans votre page html, vous devez (si vous avez fait l'exercice jusqu'au bout) avoir 2 déclarations de template (une au formalisme <strong>Mustache</strong>, l'autre au formalisme <strong>Underscore</strong>) :</p>

<p>pour Mustache :</p>

<pre><code>    &lt;!-- définition du template --&gt;
    &lt;script type="text/template" id="humans_list_template"&gt;

        &lt;ul&gt;{ {#humans} }
            &lt;li&gt;{ {id} } { {firstName} } { {lastName} } { {age} }&lt;/li&gt;
        { {/humans} }&lt;/ul&gt;

    &lt;/script&gt;
    &lt;!-- les résultats viendront ici --&gt;
    &lt;div id="humans_list"&gt;&lt;/div&gt;

    &lt;hr&gt;
</code></pre>

<p><strong>PS: Supprimez les espace entre { et { ou } } : j'ai un problème d'affichage avec Jekyll, et l'option raw semble ne pas fonctionner.</strong></p>

<p>et pour Underscore :</p>

<pre><code>    &lt;!-- définition du template --&gt;
    &lt;script type="text/template" id="humans_list_again_template"&gt;

        &lt;ul&gt;
            &lt;% _.each(humans ,function(human){ %&gt;
                &lt;li&gt; 
                    &lt;%= human.get("id") %&gt; 
                    &lt;%= human.get("firstName") %&gt; 
                    &lt;%= human.get("lastName") %&gt; 
                    &lt;%= human.get("age") ? human.get("age") : "&lt;b&gt;???&lt;/b&gt;" %&gt;
                &lt;/li&gt;
            &lt;% }); %&gt;
        &lt;/ul&gt;

    &lt;/script&gt;
    &lt;!-- les résultats viendront ici --&gt;
    &lt;div id="humans_list_again"&gt;&lt;/div&gt;
</code></pre>

<p>Vous pouvez (devez) vous débarrasser des balises <code>&lt;script&gt;</code> et de leur contenu, vous n'aurez donc plus que ceci :</p>

<pre><code>    &lt;div id="humans_list"&gt;&lt;/div&gt;

    &lt;hr&gt;

    &lt;div id="humans_list_again"&gt;&lt;/div&gt;
</code></pre>

<h3>Externalisation des templates</h3>

<p>Vous allez créer dans <code>app/assets</code> deux fichiers <code>.coffee</code> :</p>

<ul>
<li><code>humans_list_template.coffee</code></li>
<li><code>humans_list_again_template.coffee</code></li>
</ul>


<p>avec les contenus suivants (on prend les définitions de template de la page <code>index.html</code>):</p>

<p><strong><u>humans_list_template.coffee</u></strong></p>

<pre><code>App.Templates.humans_list_template = """
    &lt;ul&gt;{ {#humans} }
        &lt;li&gt;{ {id} } { {firstName} } { {lastName} } { {age} }&lt;/li&gt;
    { {/humans} }&lt;/ul&gt;
"""
</code></pre>

<p><strong>PS: Supprimez les espace entre { et { ou } } : j'ai un problème d'affichage avec Jekyll, et l'option raw semble ne pas fonctionner.</strong></p>

<p><strong><u>humans_list_again_template.coffee</u></strong></p>

<pre><code>App.Templates.humans_list_again_template = """
    &lt;ul&gt;
        &lt;% _.each(humans ,function(human){ %&gt;
            &lt;li&gt; 
                &lt;%= human.get("id") %&gt; 
                &lt;%= human.get("firstName") %&gt; 
                &lt;%= human.get("lastName") %&gt; 
                &lt;%= human.get("age") ? human.get("age") : "&lt;b&gt;???&lt;/b&gt;" %&gt;
            &lt;/li&gt;
        &lt;% }); %&gt;
    &lt;/ul&gt;
"""
</code></pre>

<p>Au lancement Play!> va transformer nos templates coffeescript en bons vieux fichiers javascript que nous allons pouvoir déclarer à notre script loader, et en plus on s'évite le fait d'aller interroger le DOM pour retrouver le contenu des balises <code>&lt;script&gt;</code>.</p>

<h3>Modification du code javascript</h3>

<p>Il va falloir modifier <code>main.js</code> &amp; <code>app.js</code> :</p>

<p><strong><u>main.js</u></strong> : nous allons ajouter le chargement de nos templates :</p>

<pre><code>yepnope({
    load: {
        jquery              : 'assets/javascripts/jquery-1.8.2.js',
        underscore          : 'assets/javascripts/underscore.js',
        backbone            : 'assets/javascripts/backbone.js',
        mustache            : 'assets/javascripts/mustache.js',
        application         : 'assets/app.js',

        //Templates
        humans_list_template         : 'assets/humans_list_template.js',
        humans_list_again_template   : 'assets/humans_list_again_template.js'  
    },
    complete : function () {
        $(function (){
            console.log("Application chargée ...");
            App.start();

        });  
    }
});
</code></pre>

<p><strong><u>app.js</u></strong> : 1ère modification, ajoutons un "namespace" <code>Templates</code> :</p>

<pre><code>/* Module */
var App = {
    Models : {},
    Collections : {},
    Views : {},
    start : function() { start(); },

    Templates : {} /* &lt;--- la modif est ici */

}
</code></pre>

<p><strong><u>app.js</u></strong> : 2ème modification, il faut re-écrire la partie des vues qui allait interroger le DOM pour récupérer le template. Maintenant, on ne fait plus appel à jQuery pour ceci, les template sont dans des variables et Play!> aura "pré compilé" les templates.</p>

<pre><code>App.Views.HumansListView = Backbone.View.extend({
    el : $("#humans_list"),
    initialize : function () {
        //this.template = $("#humans_list_template").html();

        this.template = App.Templates.humans_list_template; /* &lt;--- la modif est ici */

        //dès que la collection "change" j'actualise le rendu de la vue
        _.bindAll(this, 'render');
        this.collection.bind('reset', this.render);
        this.collection.bind('change', this.render);
        this.collection.bind('add', this.render);
        this.collection.bind('remove', this.render);

    },
    render : function () {
        var renderedContent = Mustache.to_html(this.template, { humans : this.collection.toJSON() } );
        this.$el.html(renderedContent);
    }
});
</code></pre>

<p>et :</p>

<pre><code>App.Views.HumansListAgainView = Backbone.View.extend({
    el : $("#humans_list_again"),
    initialize : function (blog) {
        //this.template = _.template($("#humans_list_again_template").html());

        this.template = _.template(App.Templates.humans_list_again_template); /* &lt;--- la modif est ici */

        _.bindAll(this, 'render');
        this.collection.bind('reset', this.render);
        this.collection.bind('change', this.render);
        this.collection.bind('add', this.render);
        this.collection.bind('remove', this.render);
    },
    render : function () {
        var renderedContent = this.template({ humans : this.collection.models });
        this.$el.html(renderedContent);         
    }           
});
</code></pre>

<p>Enregistrez, testez, normalement cela fonctionne. En plus vous avez économisé 2 appels jQuery et allégé votre page index.html, donc vous avez optimisez votre code.</p>

<p>Voilà voilà ...</p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'templates Coffeescript dans Play';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>10 May 2014</span> &raquo; <a href="/2014/05/10/ATOM-SHELL.html">Atom-shell, javascript everywhere</a></li>
            
              <li><span>09 May 2014</span> &raquo; <a href="/2014/05/09/NPM-NODE-CLI.html">Faites vos outils avec npm et node</a></li>
            
              <li><span>04 May 2014</span> &raquo; <a href="/2014/05/04/MIXIT-2014.html">MixITFR2014</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>