<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>K33G_ORG</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #b8eee9;
            border-radius: 0px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <h1>K33G_ORG's Blog</h1>
    <p></p>
    <a class="label label-info" href="/">home</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
</div>
<div class="container">

    <div class="row">
        <div id="home">
	<g:plusone size="medium"></g:plusone>
    <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    <div>
        <h3>Blog Posts (last 5)</h3>
        <ul class="posts">
            
            <li><span>10 Dec 2013</span> &raquo; <a href="/2013/12/10/POLYMER-2.html">Polymer 1er contact le retour</a></li>
            
            <li><span>07 Dec 2013</span> &raquo; <a href="/2013/12/07/POLYMER-1.html">Polymer 1er contact</a></li>
            
            <li><span>29 Nov 2013</span> &raquo; <a href="/2013/11/29/BBOM.html">Le modèle objet de Backbone</a></li>
            
            <li><span>15 Nov 2013</span> &raquo; <a href="/2013/11/15/GOLO-JAVA.html">Golo et interopérabilité Java</a></li>
            
            <li><span>13 Aug 2013</span> &raquo; <a href="/2013/08/13/THINK-SIMPLE.html">Think Simple</a></li>
            
        </ul>
    </div>

    <div id="post">
        

            <h3>10 Dec 2013</h3>

            <a href="/2013/12/10/POLYMER-2.html">comments &raquo;</a>
            <h1>Polymer : "les mains dans le cambouis", épisode 2 : Ajax</h1>

<blockquote><p><em>Nous parlerons de:</em></p>

<blockquote><ul>
<li><em>Comment faire rapidement une petite API REST avec NodeJS et Express</em></li>
<li><em>Comment faire des requêtes <code>GET</code> avec le composant <code>&lt;polymer-ajax&gt;</code></em></li>
<li><em>Comment faire des requêtes <code>POST</code> avec le composant <code>&lt;polymer-ajax&gt;</code></em></li>
</ul>
</blockquote>

<p><em>Cet article est beaucoup plus court que le précédent, mais reste incontournable si vous voulez réaliser des SPA ayant des interactions avec un serveur.</em></p></blockquote>

<h2>Pré-requis</h2>

<p>Tout d'abord, il faut avoir lu le tuto précédent : <a href="http://k33g.github.io/2013/12/07/POLYMER-1.html">http://k33g.github.io/2013/12/07/POLYMER-1.html</a>.</p>

<p>Ensuite, pour ce 2ème épisode nous aurons besoin d'un serveur qui puisse nous renvoyer du flux json et auquel nous pourrons envoyer des données (nous allons stocker notre liste côté serveur). Après réflexion (utiliser Play, utiliser SparkJava, ...), j'ai donc décidé d'aller au plus simple : utiliser <strong><a href="http://nodejs.org/">NodeJS</a></strong> et <strong><a href="http://expressjs.com/">Express</a></strong>. Je pars du principe que vous avez installé déjà installé <strong><a href="http://nodejs.org/">NodeJS</a></strong> <em>(et donc le gestionnaire de package npm)</em>.</p>

<h3>Création du serveur</h3>

<ul>
<li>en mode console, installez Express : tapez <code>sudo npm -g install express</code> (sous Windows pas besoin de <code>sudo</code>)</li>
<li>puis créez un répertoire pour votre application (dans mon cas : <code>02-ajax</code>)</li>
<li><p>dans ce répertoire (<code>cd 02-ajax</code>), créez un fichier <code>package.json</code> avec le contenu suivant</p>

<pre><code>  {
    "name": "hello-polymer",
    "description": "hello-polymer app",
    "version": "0.0.1",
    "dependencies": {
      "express": "3.x"
    }
  }
</code></pre></li>
<li><p>ensuite, tapez <code>npm install</code>, les dépendances nécessaires pour faire tourner Express vont être installées</p></li>
<li>créer ensuite (toujours dans le répertoire de votre application) un répertoire <code>public</code> dans lequel vous pouvez copier l'ensemble des fichiers de l'article précédent (<code>index.html</code>, le répertoire <code>components</code> et son contenu, et faites de même pour le répertoire <code>bower_components</code>)</li>
</ul>


<p>Vous devriez avoir l'arborescence suivante :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-011.png" alt="Alt &quot;011.png&quot;" /></p>

<h3>Création de l'application Express</h3>

<p>Rien de plus simple. Créez dans votre répertoire applicatif un fichier <code>app.js</code> avec le code suivant:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="kd">var</span> <span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Doctor No&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
<span class="p">];</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">buddies</span><span class="p">))</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">buddy</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
  <span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">buddy</span><span class="p">)</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">buddy</span><span class="p">))</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
</code></pre></div>


<p>Pour lancer notre application, il suffira de lancer <code>node app.js</code>, vous pouvez tester dès maintenant avec l'url <code>http://localhost:3000</code> dans votre navigateur, vous arriverez sur le contenu de notre page <code>index.html</code>. Si vous avez le plugin <strong>Postman</strong> pour Chrome, vous pouvez tester votre "api" dès maintenant <em>(vous pouvez aussi utilisez curl)</em>.</p>

<h4>Requête GET</h4>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-012.png" alt="Alt &quot;012.png&quot;" /></p>

<h4>Requête POST</h4>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-013.png" alt="Alt &quot;013.png&quot;" /></p>

<p>Relancez la requête <code>GET</code> :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-014.png" alt="Alt &quot;014.png&quot;" /></p>

<p>Nous avons bien un nouvel enregistrement. Notre serveur est opérationnel. Nous pouvons retourner faire du <strong>Polymer</strong>.</p>

<h2><code>&lt;buddies-list&gt;</code> appelle le serveur</h2>

<p>Alors souvenez-vous, notre "liste de copains" <code>&lt;buddies-list&gt;</code>avait le code suivant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;buddies-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;polymer-signals</span> <span class="na">on-polymer-signal-newbuddy=</span><span class="s">&quot;{{onNewBuddySignal}}&quot;</span><span class="nt">&gt;&lt;/polymer-signals&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{title}}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;template</span> <span class="na">repeat=</span><span class="s">&quot;{{buddies}}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span>{{name}}<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;buddies-list&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Title is &quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Doctor No&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
        <span class="p">];</span>
      <span class="p">},</span>
      <span class="nx">onNewBuddySignal</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Sender : &quot;</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Nous souhaitons que notre liste soit "remplie" par les infos du serveur. Pour cela nous allons utiliser le composant <code>&lt;polymer-ajax&gt;</code> (qui a été installé avec la commande <code>bower install polymer-elements</code> lors du 1er épisode)</p>

<ul>
<li>Supprimez le code de la méthode <code>ready</code></li>
<li>Dans <code>&lt;template&gt;</code> on ajoute le composant <code>&lt;polymer-ajax&gt;</code> en précisant ses attributs et callbacks</li>
<li>Dans la méthode <code>onReceive(response)</code> déclenchée une fois que nous recevons les données du serveur, on affecte les données reçues à la propriétés <code>buddies</code> du composant <em>(propriété utilisée dans le template)</em></li>
<li>Remarque : dans le tag <code>&lt;polymer-ajax&gt;</code> vous remarquerez l'attribut <code>auto</code>, qui lance automatiquement la requête.</li>
</ul>


<p>Votre code devrez ressembler à ceci :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;buddies-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;polymer-ajax</span> <span class="na">id=</span><span class="s">&quot;xhr&quot;</span> <span class="na">auto</span> <span class="na">handleAs=</span><span class="s">&quot;json&quot;</span> <span class="na">method=</span><span class="s">&quot;GET&quot;</span> <span class="na">url=</span><span class="s">&quot;buddies&quot;</span>
                  <span class="na">on-polymer-response=</span><span class="s">&quot;{{onReceive}}&quot;</span>
                  <span class="na">on-polymer-error=</span><span class="s">&quot;{{onError}}&quot;</span>
                  <span class="na">on-polymer-complete=</span><span class="s">&quot;{{onComplete}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/polymer-ajax&gt;</span>
    <span class="nt">&lt;polymer-signals</span> <span class="na">on-polymer-signal-newbuddy=</span><span class="s">&quot;{{onNewBuddySignal}}&quot;</span><span class="nt">&gt;&lt;/polymer-signals&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{title}}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;template</span> <span class="na">repeat=</span><span class="s">&quot;{{buddies}}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span>{{name}}<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;buddies-list&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

      <span class="p">},</span>
      <span class="nx">onReceive</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">onError</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*foo*/</span> <span class="p">},</span>
      <span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*foo*/</span> <span class="p">},</span>

      <span class="nx">onNewBuddySignal</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Sender : &quot;</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Si vous ouvrez votre navigateur avec l'url <a href="http://localhost:3000/">http://localhost:3000/</a>, vous devriez voir s'afficher la nouvelle liste.</p>

<p>Il ne nous reste plus qu'à gérer l'ajout de nouveaux "buddies".</p>

<h2><code>&lt;hello-john-doe&gt;</code> parle aussi au serveur</h2>

<p>Nous allons modifier notre composant <code>&lt;hello-john-doe&gt;</code> pour qu'il fasse des requêtes de type <code>POST</code> vers notre serveur (pour ajouter des "buddies" à la liste).</p>

<p>Notre code était le suivant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;hello&quot;</span><span class="nt">&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">on-click=</span><span class="s">&quot;{{clickMe}}&quot;</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">nameChanged</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">clickMe</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">&quot;CLICKED&quot;</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">asyncFire</span><span class="p">(</span>
          <span class="s1">&#39;polymer-signal&#39;</span><span class="p">,</span>
          <span class="p">{</span>
            <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;newbuddy&quot;</span><span class="p">,</span>
            <span class="nx">data</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<ul>
<li>Là aussi nous allons utiliser le composant <code>&lt;polymer-ajax&gt;</code> mais avec <code>method="POST"</code> et sans attribut <code>auto</code></li>
<li>Nous changeons la méthode <code>clickMe</code> : lorsque l'on appuie sur le bouton, on passe les informations <code>{ name : this.name }</code> au seveur par le biais d'une requête <code>POST</code>.</li>
<li>La commande <code>this.$.xhr.go();</code> sert à déclencher l'appel ajax de type <code>POST</code> au serveur <em>(où <code>xhr</code> est l'id du composant <code>&lt;polymer-ajax&gt;</code>)</em></li>
<li>Une fois la réponse du serveur obtenue, la méthode <code>onReceive</code> est déclenchée (callback), donc nous déclenchons le signal <code>"newbuddy"</code> avec <code>asyncFire()</code> <em>(cette fois ci pas besoin de passer les données, il faut juste déclencher le signal)</em>.</li>
</ul>


<p>Voici le code modifié :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;polymer-ajax</span> <span class="na">id=</span><span class="s">&quot;xhr&quot;</span> <span class="na">handleAs=</span><span class="s">&quot;json&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span> <span class="na">url=</span><span class="s">&quot;buddies&quot;</span>
                  <span class="na">on-polymer-response=</span><span class="s">&quot;{{onReceive}}&quot;</span>
    <span class="err">&lt;/</span><span class="na">polymer-ajax</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;hello&quot;</span><span class="nt">&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">on-click=</span><span class="s">&quot;{{clickMe}}&quot;</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">nameChanged</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">clickMe</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">&quot;CLICKED&quot;</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">xhrArgs</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
          <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">name</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="p">})</span>
        <span class="p">};</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">go</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">onReceive</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">asyncFire</span><span class="p">(</span>
          <span class="s1">&#39;polymer-signal&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;newbuddy&quot;</span> <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Allons juste modifier le code du composant <code>&lt;buddies-list&gt;</code> pour qu'il rafraîchisse la liste lors de l'ajout d'un élément. Pour cela il suffit de modifier dans <code>buddies-list.html</code> la méthode <code>onNewBuddySignal()</code> <em>(déclenchée par le signal "newbuddy")</em> de cette façon :</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">onNewBuddySignal</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">go</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>


<p>Avec <code>this.$.xhr.go();</code>, on appelle la requête de type <code>GET</code> du composant.</p>

<p>Il ne vous reste maintenant plus qu'à tester.</p>

<p>Vous trouverez le code de l'exemple ici : <a href="https://github.com/k33g/polymer-les-mains-dans-le-cambouis/tree/master/02-ajax">https://github.com/k33g/polymer-les-mains-dans-le-cambouis/tree/master/02-ajax</a>.</p>

<blockquote><p><em>Piste de réflexion : j'ai embarqué le composant <code>&lt;polymer-ajax&gt;</code> au sein de mes composants. Il pourrait être intéressant de les "extraire" et les rendre indépendants, et les faire communiquer avec les autres composants par l'émission et la réception de signaux</em>.</p></blockquote>

<p>Bonne lecture.</p>

            <br>
            <a href="/2013/12/10/POLYMER-2.html">comments &raquo;</a>
            <br>
            <hr style="border: 1px; border-color: #cccccc; border-style: dashed; ">
            <br>
        

            <h3>07 Dec 2013</h3>

            <a href="/2013/12/07/POLYMER-1.html">comments &raquo;</a>
            <h1>Polymer : "les mains dans le cambouis", épisode 1</h1>

<blockquote><p><em>Nous parlerons de:</em></p>

<blockquote><ul>
<li><em>Les pré-requis et installation</em></li>
<li><em>Ecriture de 2 composants polymer</em></li>
<li><em>Communication entre composants polymer</em></li>
</ul>
</blockquote>

<p><em>Polymer est un nouveau framework javascript à base de composants web écrits par des développeurs de chez Google. Il s'appuie donc sur la norme des <strong>Web Components</strong> et parie sur les évolutions des navigateurs dans le futur (notamment sur l'implémentation du pattern Observer, comme le fait <strong>Angular</strong>). <strong>Polymer</strong> en attendant que ces évolutions "arrivent" fournit les <strong>polyfills</strong> nécessaires. <strong>Polymer</strong> est tout jeune et en plein développement (donc sujet à modifications fréquentes), mais il mérite que l'on s'y intéresse (ne serait-ce que parce qu'il vient de chez Google) car il est assez simple d'accès, aussi magique qu'Angular (mais probablement avec un temps d'apprentissage plus rapide). De plus <strong>Polymer</strong> est aussi porté côté <strong>Dart</strong> et pourrait devenir la partie "IHM" d'Angular (à vérifier).</em></p>

<p><em>Cet article ne va pas vous parler plus que ça du concept des "Web Components". Je vous invite vivement à lire l'excellent article de <a href="https://twitter.com/julienvey">@julienvey</a> sur le sujet (en français en plus donc profitez-en) : <a href="http://www.infoq.com/fr/articles/polymer-nouveaux-standards-web">http://www.infoq.com/fr/articles/polymer-nouveaux-standards-web</a>.</em></p></blockquote>

<p>Cet article va plutôt être "pratico-pratique" pour vous mettre le pied à l'étrier si vous avez envie de voir rapidement si <strong>Polymer</strong> est fait pour vous.</p>

<p>Tous les exemples présentés dans cet épisode et dans ceux à venir sont(seront) disponibles ici : <a href="https://github.com/k33g/polymer-les-mains-dans-le-cambouis">https://github.com/k33g/polymer-les-mains-dans-le-cambouis</a>.</p>

<p>Pour cet épisode vous trouverez tous les éléments ici : <a href="https://github.com/k33g/polymer-les-mains-dans-le-cambouis/tree/master/01-introduction">https://github.com/k33g/polymer-les-mains-dans-le-cambouis/tree/master/01-introduction</a></p>

<h2>Pré-requis</h2>

<h3>1 serveur web</h3>

<p>Tout d'abord, il vous faudra il vous faudra un serveur web. Pour ce 1er épisode, nul besoin de quelque chose de très compliqué. Si vous êtes sous OSX ou Linux, une simple commande <code>python -m SimpleHTTPServer</code> dans votre répertoire de travail fera l'affaire. Sinon vous pouvez aussi utiliser <a href="https://github.com/nodeapps/http-server">https://github.com/nodeapps/http-server</a>, pour l'installer : <code>npm install http-server -g</code> et ensuite il suffit de lancer la commande <code>http-server</code> dans votre répertoire de travail.</p>

<p>Il ne vous reste plus qu'à créer un répertoire de travail que nous appellerons <code>01-introduction</code>.</p>

<p>Néanmoins n'importe quel serveur http, serveur d'application convient, d'ailleurs dans un prochain épisode nous utiliserons <strong>Polymer</strong> avec <strong>Play 2 Scala</strong>.</p>

<h3>Installation de Polymer</h3>

<p>Pour installer <strong>Polymer</strong>, le plus simple pour le moment est d'utiliser <strong><a href="http://bower.io/">Bower</a></strong>. Pour l'installer, rien de plus simple : <code>npm install -g bower</code> <em>(vous aurez compris qu'il sera plus pratique d'avoir installé NodeJS sur votre poste, même si vous pouvez reproduire toutes ces manipulation à la main)</em>.</p>

<p>Pour "installer" Polymer :</p>

<pre><code>cd 01-introduction
bower install polymer
</code></pre>

<p><strong>Bower</strong> a crée un répertoire <code>bower_components</code> avec les librairies nécessaires dans 2 sous-répertoires <code>platform</code> et <code>polymer</code>.</p>

<p>Il ne vous reste plus qu'à créer une page <code>index.html</code> avec le code suivant :</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>01-introduction<span class="nt">&lt;/title&gt;</span>
  <span class="c">&lt;!-- Load Polymer --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bower_components/platform/platform.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bower_components/polymer/polymer.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>Nous sommes prêts.</p>

<h2>Premier composant Polymer (Polymer element)</h2>

<p>Un composant Polymer se compose généralement d'une portion de code html et d'une portion de code javascript sous cette forme :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;mon-composant&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="c">&lt;!-- foo --&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;mon-composant&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>La méthode <code>ready()</code> est déclenchée à l'initialisation du composant. Maintenant, faisons le notre. Et ainsi vous disposez d'un nouveau tag html <code>&lt;mon-composant&gt;</code>.</p>

<h3>Création du composant hello-john-doe</h3>

<p>Dans votre répertoire de travail, créez un répertoire <code>components</code> puis dans ce sous-répertoire créez un fichier html <code>hello-john-doe.html</code> et saisissez le code suivant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p><strong>Remarque : le nom d'un composant doit toujours être au minimum composé de 2 parties séparées par un <code>-</code>.</strong></p>

<h3>Déclaration et utilisation du composant</h3>

<p>Dans votre page <code>index.html</code>, il faut déclare votre composant au niveau de <code>&lt;head&gt;&lt;/head&gt;</code> de cette façon : <code>&lt;link rel="import" href="components/hello-john-doe.html"&gt;</code> et ensuite il suffira d'utiliser <code>&lt;hello-john-doe&gt;&lt;/hello-john-doe&gt;</code> dans votre page html, comme ceci :</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>01-introduction<span class="nt">&lt;/title&gt;</span>
  <span class="c">&lt;!-- Load Polymer --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bower_components/platform/platform.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bower_components/polymer/polymer.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

  <span class="c">&lt;!-- my components --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;import&quot;</span> <span class="na">href=</span><span class="s">&quot;components/hello-john-doe.html&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;hello-john-doe&gt;&lt;/hello-john-doe&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>Maintenant vous pouvez lancer votre serveur web (ie: <code>http-server</code>) et appeler votre page dans votre navigateur : <a href="[http://localhost:numero_de_port]">http://localhost:numero_de_port</a> :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-001.png" alt="Alt &quot;001.png&quot;" /></p>

<p>Vous pouvez voir que la valeur de <code>name</code> a bien été initialisée à <code>John Doe</code> avec la méthode <code>render()</code>. Et si vous saisissez un nouveau nom, le contenu du tag <code>&lt;h1&gt;&lt;/h1&gt;</code> change automatiquement :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-002.png" alt="Alt &quot;002.png&quot;" /></p>

<h3>Tips : Accéder à un composant de l'extérieur :</h3>

<p>Ce n'est pas forcément une bonne pratique, mais c'est bon à savoir. Une fois votre composant déclaré dans votre page html, c'est un composant du DOM à part entière, donc si vous souhaitez y accéder, vous pouvez procéder de la manière suivante pour obtenir une référence à celui-ci :</p>

<pre><code>var helloJohn = document.querySelectorAll("hello-john-doe")[0]
</code></pre>

<p>Et ainsi, vous pouvez accéder à ses propriétés et les modifier, comme <code>name</code> dans notre exemple : <code>helloJohn.name = "Actarus"</code>, et le changement dans le composant se fera automatiquement :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-003.png" alt="Alt &quot;003.png&quot;" /></p>

<h3>Instances du composant hello-john-doe</h3>

<p>Déclarez un 2 ème composant <code>&lt;hello-john-doe&gt;</code> dans votre page :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;hello-john-doe&gt;&lt;/hello-john-doe&gt;</span>
  <span class="nt">&lt;hr&gt;</span>
  <span class="nt">&lt;hello-john-doe&gt;&lt;/hello-john-doe&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div>


<p>Ouvrez à nouveau la page avec votre navigateur, vous noterez que les 2 composants <code>&lt;hello-john-doe&gt;</code> fonctionnent de manière indépendante :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-004.png" alt="Alt &quot;004.png&quot;" /></p>

<h3><code>OnChange()</code> et autres petites choses ...</h3>

<p>A tout propriété d'un composant Polymer, vous pouvez associer une méthode qui sera déclenchée à chaque changement de la propriété, cette méthode prend comme nom, le nom de la propriété + <code>Changed</code>, donc dans le cas qui nous concerne ce sera <code>nameChanged</code>. Modifiez donc le code de notre composant de la manière suivante :</p>

<ul>
<li>ajout d'un <code>id</code> au tag <code>h1</code> : <code>&lt;h1 id="hello"&gt;Hello  {{name}} &lt;/h1&gt;</code></li>
<li>ajout d'une méthode <code>nameChanged()</code></li>
</ul>


<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;hello&quot;</span><span class="nt">&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">nameChanged</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Ouvrez à nouveau la page avec votre navigateur :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-005.png" alt="Alt &quot;005.png&quot;" /></p>

<p><strong>Vous noterez l'utilisation de <code>$</code> qui permet d'accéder automatiquement à l'élément d'id <code>hello</code>.</strong></p>

<h3>Ajoutons un "OnClick"</h3>

<p>Proposons un peu plus d'action à notre composant en lui ajoutant un bouton, et une méthode associée au "click" sur le bouton :</p>

<ul>
<li>dans la partie "html" (donc à l'intérieur de <code>&lt;template&gt;&lt;/template&gt;</code>), on ajoute : <code>&lt;button on-click=" {{clickMe}} "&gt;Click Me!&lt;/button&gt;</code> où <code>clickMe</code> dans <code>{{clickMe}}</code> est le nom de la méthode appelé lorsque l'on clique sur le bouton</li>
<li>dans la partie "javascript", on ajoute une méthode <code>clickMe()</code></li>
</ul>


<p>Nous obtiendrons le code suivant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;hello&quot;</span><span class="nt">&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">on-click=</span><span class="s">&quot;{{clickMe}}&quot;</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">nameChanged</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">clickMe</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">&quot;CLICKED&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Ouvrez à nouveau la page avec votre navigateur :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-006.png" alt="Alt &quot;006.png&quot;" /></p>

<h2>Deuxième composant Polymer : une liste</h2>

<p>Nous allons créer une 2ème composant destiné à afficher une liste d'éléments, nous appellerons ce nouveau composant : <code>&lt;buddies-list&gt;&lt;/buddies-list&gt;</code>. Donc créez un nouveau fichier <code>buddie-list.html</code> dans le répertoire <code>components</code> avec le code suivant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;buddies-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;template</span> <span class="na">repeat=</span><span class="s">&quot;{{buddies}}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span>{{name}}<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;buddies-list&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Doctor No&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
        <span class="p">];</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Ensuite, déclarez votre composant dans <code>index.html</code> : <code>&lt;link rel="import" href="components/buddies-list.html"&gt;</code> et vous pouvez maintenant utiliser directement le nouveau tag : <code>&lt;buddies-list&gt;&lt;/buddies-list&gt;</code> :</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>01-introduction<span class="nt">&lt;/title&gt;</span>
  <span class="c">&lt;!-- Load Polymer --&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bower_components/platform/platform.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bower_components/polymer/polymer.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

  <span class="c">&lt;!-- my components --&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;import&quot;</span> <span class="na">href=</span><span class="s">&quot;components/hello-john-doe.html&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;import&quot;</span> <span class="na">href=</span><span class="s">&quot;components/buddies-list.html&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;hello-john-doe&gt;&lt;/hello-john-doe&gt;</span>
  <span class="nt">&lt;hr&gt;</span>
  <span class="nt">&lt;buddies-list&gt;&lt;/buddies-list&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>Ouvrez à nouveau la page avec votre navigateur :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-007.png" alt="Alt &quot;007.png&quot;" /></p>

<p>Comme avec le composant précédent, nous pouvons accéder "de l'extérieur" à notre composant pour par exemple lui ajouter des éléments :</p>

<pre><code>document.querySelector("buddies-list").buddies.push({name : "Emma Peel"})
</code></pre>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-008.png" alt="Alt &quot;008.png&quot;" /></p>

<h3>Tips : jouons avec les attributs</h3>

<p>Imaginez que vous déclarez votre nouveau composant de la manière suivante :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;buddies-list</span> <span class="na">title=</span><span class="s">&quot;Buddies List&quot;</span><span class="nt">&gt;&lt;/buddies-list&gt;</span>
</code></pre></div>


<p>Le simple fait d'avoir ajouter un attribut <code>title</code> dans la définition du tag a créé un propriété <code>title</code> pour notre composant <code>buddies-list</code>, accessible aussi bien au niveau du code html (au sein de la balise <code>&lt;template&gt;&lt;/template&gt;</code>) qu'au niveau du code javascript. Modifiez le composant <code>buddies-list</code> de la façon suivante :</p>

<ul>
<li>ajout de <code>&lt;h2&gt; {{title}} &lt;/h2&gt;</code>dans la section <code>template</code></li>
<li>lecture de la valeur de <code>title</code> dans la méthode <code>ready()</code> : <code>console.log("Title is ", this.title);</code></li>
</ul>


<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;buddies-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{title}}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;template</span> <span class="na">repeat=</span><span class="s">&quot;{{buddies}}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span>{{name}}<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;buddies-list&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Title is &quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Doctor No&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
        <span class="p">];</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Ouvrez à nouveau la page avec votre navigateur :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-009.png" alt="Alt &quot;009.png&quot;" /></p>

<p>Nous avons donc maintenant un titre pour notre liste, que l'on peut paramétrer à partir d'un attribut dans le tag html correspondant au composant (<code>&lt;buddies-list title="Buddies List"&gt;&lt;/buddies-list&gt;</code>).</p>

<h2>Les composants parlent au composants</h2>

<p>Il serait intéressant maintenant que les éléments saisis dans le 1er composant puissent être ajoutés dans la liste du 2ème composant lorsque l'on clique sur le bouton (j'imagine que vous m'aviez vu venir de loin ...). Il existe différentes méthodes pour communiquer entre composants de Polymer (Un peu de lecture par ici si vous le souhaitez : <a href="http://www.polymer-project.org/articles/communication.html">http://www.polymer-project.org/articles/communication.html</a>), et ma préférée est celle qui fonctionne à base de signaux grâce au composant <strong><a href="http://www.polymer-project.org/docs/elements/#polymer-signals"><code>&lt;polymer-signals&gt;</code></a></strong>. Pour l'utiliser nous allons devoir installer les "polymer elements" qui sont des composant Polymer supplémentaires, dont notamment <code>&lt;polymer-signals&gt;</code>.</p>

<p>Pour se faire, nous utiliserons <strong>Bower</strong> une fois de plus :</p>

<pre><code>bower install polymer-elements
</code></pre>

<p>Une fois les nouveaux éléments installés, nous pouvons donc utiliser <code>&lt;polymer-signals&gt;</code>. Nous aurons donc un composant qui sera "l'emetteur de signal", dans notre cas le composant <code>&lt;hello-john-doe&gt;&lt;/hello-john-doe&gt;</code> qui enverra le signal <code>newbuddy</code> et le récepteur sera notre composant <code>&lt;buddies-list&gt;&lt;/buddies-list&gt;</code>.</p>

<p><strong>Avant toute chose n'oublions pas</strong> de référencer <code>&lt;polymer-signals&gt;</code>:</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;import&quot;</span>
        <span class="na">href=</span><span class="s">&quot;bower_components/polymer-elements/polymer-signals/polymer-signals.html&quot;</span><span class="nt">&gt;</span>
</code></pre></div>


<p>Puis transformons <code>&lt;hello-john-doe&gt;&lt;/hello-john-doe&gt;</code> en emetteur.</p>

<h3>L'emetteur</h3>

<p>Modifiez le code de <code>hello-john-doe.html</code> de la façon suivante :</p>

<p>Nous ajoutons l'envoi d'un signal <code>newbuddy</code> à l'aide de <code>asyncFire()</code> dans la méthode <code>clickMe()</code> :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;hello-john-doe&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">&quot;hello&quot;</span><span class="nt">&gt;</span>Hello {{name}}<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">value=</span><span class="s">&quot;{{name}}&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">on-click=</span><span class="s">&quot;{{clickMe}}&quot;</span><span class="nt">&gt;</span>Click Me!<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;hello-john-doe&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">nameChanged</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">clickMe</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">.</span><span class="nx">hello</span><span class="p">.</span><span class="nx">innerHTML</span><span class="o">=</span><span class="s2">&quot;CLICKED&quot;</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">asyncFire</span><span class="p">(</span>
          <span class="s1">&#39;polymer-signal&#39;</span><span class="p">,</span>
          <span class="p">{</span>
            <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;newbuddy&quot;</span><span class="p">,</span>
            <span class="nx">data</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">name</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Nous passons donc à <code>asyncFire()</code> le nom du signal (<code>name : "newbuddy"</code>) et les données à envoyer (<code>data : { name : this.name }</code>).</p>

<p>Il nous faut maintenant un récepteur, donc transformons <code>&lt;buddies-list&gt;&lt;/buddies-list&gt;</code>.</p>

<h3>Le récepteur</h3>

<ul>
<li>Ajoutons dans la partie html du composant la déclaration suivante <code>&lt;polymer-signals on-polymer-signal-newbuddy=" {{onNewBuddySignal}} "&gt;&lt;/polymer-signals&gt;</code> qui signifie que notre récepteur s'abonne au signal <code>newbuddy</code>et qu'il déclenchera la méthode <code>onNewBuddySignal()</code> s'il "entend" le signal. <strong>Important :</strong> il faut bien respecter la notation <code>on-polymer-signal-newbuddy</code> avec le nom du signal <strong>bien orthographié</strong>, en <strong>1 seul mot</strong> et en <strong>minuscules</strong>. Pour le nom de la méthode <code>onNewBuddySignal()</code> par contre vous faites comme vous le sentez.</li>
<li>Ajoutons la méthode <code>onNewBuddySignal()</code> déclenchée par le signal</li>
</ul>


<p>Nous aurons donc le code suivant pour <code>buddies-list</code> :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;polymer-element</span> <span class="na">name=</span><span class="s">&quot;buddies-list&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;template&gt;</span>
    <span class="nt">&lt;polymer-signals</span> <span class="na">on-polymer-signal-newbuddy=</span><span class="s">&quot;{{onNewBuddySignal}}&quot;</span><span class="nt">&gt;&lt;/polymer-signals&gt;</span>
    <span class="nt">&lt;h2&gt;</span>{{title}}<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;template</span> <span class="na">repeat=</span><span class="s">&quot;{{buddies}}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;li&gt;</span>{{name}}<span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;/template&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/template&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="nx">Polymer</span><span class="p">(</span><span class="s2">&quot;buddies-list&quot;</span><span class="p">,{</span>
      <span class="nx">ready</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Title is &quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Doctor No&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
        <span class="p">];</span>
      <span class="p">},</span>
      <span class="nx">onNewBuddySignal</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Sender : &quot;</span><span class="p">,</span> <span class="nx">sender</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/polymer-element&gt;</span>
</code></pre></div>


<p>Donc, à la réception du signal <code>newbuddy</code> nous ajouterons les données envoyées par l'émetteur : <code>this.buddies.push(data)</code> <em>(au passage remarquez que vous pouvez récupérer une référence de l'émetteur via l'argument <code>sender</code>)</em>.</p>

<p>Il ne vous reste plus qu'à tester. Ouvrez à nouveau la page avec votre navigateur :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/polymer-010.png" alt="Alt &quot;010.png&quot;" /></p>

<p>Voilà!. Et de cette manière vous n'êtes pas obligés d'accéder aux composants "par l'extérieur" puisqu'ils peuvent communiquer par "signaux".</p>

<p>Bien sûr, un composant peut être à la fois émetteur et récepteur, s'abonner à différents signaux, etc. ...</p>

<p>C'est tout pour aujourd'hui. Cela vous laisse le temps de vous amuser un peu avec. Au prochain épisode, nous verrons comment "discuter" avec le serveur (nous parlerons d'ajax, json, REST, ...) mais aussi nous vérifierons si <strong>Polymer</strong> reste compatible avec les autres frameworks javascript (la question étant, puis-je continuer à utiliser jQuery, Backbone, Underscore, ...).</p>

<p>Bonne Lecture (et bon WE à tous) ;).</p>

            <br>
            <a href="/2013/12/07/POLYMER-1.html">comments &raquo;</a>
            <br>
            <hr style="border: 1px; border-color: #cccccc; border-style: dashed; ">
            <br>
        

            <h3>29 Nov 2013</h3>

            <a href="/2013/11/29/BBOM.html">comments &raquo;</a>
            <h1>Le modèle objet de Backbone est puissant, mais ATTENTION! (ceci est un cri)</h1>

<p>Je ne présente plus <a href="http://backbonejs.org/">Backbone</a>, cette petite librairie javascript MVC survitaminée. Un des aspects importants de Backbone, c'est son modèle objet que l'on peut deviner à travers ses différents composants (Model, Collection, View, Router). Ce modèle est séduisant car il nous permet de reproduire une logique <strong>"orientée classe"</strong> dans notre code javascript, mais attention les raccourcis peuvent être dangereux, car le modèle objet javascript est lui très différent d'un modèle objet tel celui de Java, .Net, etc. ... Au passage je vous conseille cette excellente lecture : <a href="http://naholyr.fr/2011/02/le-point-sur-javascript-et-heritage-prototypal/">"Le point sur Javascript et l’héritage prototypal"</a> par <a href="https://twitter.com/naholyr">Naholyr</a>.</p>

<p>Je me suis fait avoir pas plus tard qu'hier, donc voici une piqûre de rappel à travers 2 composants de Backbone (Modèles et Vues) sur quelques pièges à éviter. Les concepts sont applicables à l'ensemble des composants.</p>

<h2>Les modèles</h2>

<h3>Rappel</h3>

<p>Un modèle en Backbone est la structure de données qui va donc porter les informations. Généralement, il se définit de la façon suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Human</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

<span class="p">});</span>

<span class="kd">var</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Morane&quot;</span><span class="p">});</span>
</code></pre></div>


<p>Donc <code>bob</code> est une instance de <code>Human</code> qui lui-même <strong>"hérite"</strong> de <code>Backbone.Model</code>, et sa structure ressemble à ceci :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-01.png" alt="Alt &quot;BBOM-01.png&quot;" /></p>

<p>Nous avons passé les <code>fields</code> (<code>properties</code>) et leurs valeurs directement dans le constructeur de <code>Human</code> et maintenant nous pouvons accéder à ces propriétés de la façon suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="c1">//Qui es tu ?</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;firstName&quot;</span><span class="p">),</span> <span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">))</span>

<span class="c1">//Je veux mon nom en majuscule</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">,</span><span class="s2">&quot;MORANE&quot;</span><span class="p">)</span>

<span class="c1">//Ou bien</span>
<span class="nx">bob</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;BOB&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;MORANE&quot;</span><span class="p">})</span>
</code></pre></div>


<p>Les méthodes d'instance de <code>Model</code>, donc <code>get</code> et <code>set</code> sont les équivalents de "getter" et "setter", et ils permettent d'accéder et modifier la propriété <code>attributes</code> qui contient l'ensemble des données de la structure.</p>

<h3>Le piège : les valeurs par défaut</h3>

<p>Dans les modèles Backbone, il est possible de définir des valeurs par défaut, de la façon suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Human</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">defaults</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
        <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
        <span class="nx">friends</span><span class="o">:</span><span class="p">[]</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>C'est très pratique. Vous pouvez ensuite instancier vos modèles et ajouter des <code>friends</code> à <code>bob</code>:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Morane&quot;</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">john</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">jane</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;Jane&quot;</span><span class="p">})</span>

<span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;friends&quot;</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">john</span><span class="p">,</span> <span class="nx">jane</span><span class="p">)</span>
</code></pre></div>


<p>Et là c'est le drame. Allons voir les "copains" de <code>jane</code> et de <code>john</code> (mais euh ... tu ne parlais de <code>bob</code> ?)</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-02.png" alt="Alt &quot;BBOM-02.png&quot;" /></p>

<p>Mais que s'est-il passé!? En fait, le champ <code>friends</code> est <strong>partagé</strong> entre toutes les instances!</p>

<p>Alors quand on vous dit de lire la documentation, ce n'est pas pour rien :) Mais dans ce cas là, ils auraient pu l'afficher en rouge et en gras. Sur <a href="http://backbonejs.org/#Model-defaults">http://backbonejs.org/#Model-defaults</a>, il est dit  <strong>en petit et en italique</strong> ceci :</p>

<p><em>Remember that in JavaScript, objects are passed by reference, so if you include an object as a default value, it will be shared among all instances. Instead, define defaults as a function.</em></p>

<h3>Solution</h3>

<p>Donc pour la faire simple et rapide, définissez vos valeurs par défaut avec une fonction de la manière suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Human</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">defaults</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">firstName</span><span class="o">:</span><span class="s2">&quot;John&quot;</span><span class="p">,</span>
        <span class="nx">lastName</span><span class="o">:</span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span>
        <span class="nx">friends</span><span class="o">:</span><span class="p">[]</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>Et là, cela va tout de suite mieux :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-03.png" alt="Alt &quot;BBOM-03.png&quot;" /></p>

<p>Passons donc à la problématique suivante (dont les origines sont identiques) à l'aide des vues.</p>

<h2>Les vues</h2>

<p>La problématique qui va suivre est aussi valable pour les modèles, collections et routeurs mais on la trouve plus souvent dans le cas des vues.</p>

<h3>Très rapide petit rappel</h3>

<p>La vue dans Backbone (<code>Backbone.View</code>) est la structure qui va faire le lien entre vos modèles et votre affichage "HTML" dans le navigateur. ... C'est donc ... un contrôleur (<em>private joke</em>).</p>

<p>Elle se définit généralement de la manière suivante :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">Humans</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">model</span> <span class="o">:</span> <span class="nx">Human</span>
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;ul&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span>
      <span class="s2">&quot;&lt;% _.each(humans ,function(human){ %&gt;&quot;</span><span class="o">+</span>
      <span class="s2">&quot;&lt;li&gt;&lt;%= human.firstName %&gt; - &lt;%= human.lastName %&gt;&lt;/li&gt;&quot;</span><span class="o">+</span>
      <span class="s2">&quot;&lt;% }); %&gt;&quot;</span>
    <span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">renderedContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">({</span><span class="nx">humans</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">renderedContent</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])})</span>
<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</code></pre></div>


<p>Côté HTML, j'ai juste à ajouter <code>&lt;ul&gt;&lt;/ul&gt;</code> dans ma page, et le contenu de ma vue ira gentiment s'insérer au milieu.</p>

<p>Et là tout va bien :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-04.png" alt="Alt &quot;BBOM-04.png&quot;" /></p>

<h3>Le piège : encore une histoire de partage!</h3>

<p>Ce cas de figure voudrait que l'on utilise des "subviews" (une vue par modèle), comme cela chaque sous-vue possède son propre modèle d'événements, méthodes etc. ... ce qui permet d'interagir de manière unitaire sur les éléments de la liste, de ne pas être obligé de tout recharger pour rafraîchir un seul élément, etc. ... etc. ...</p>

<p>Donc notre code devrait ressembler à ceci :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">HumanItemView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">tagName</span><span class="o">:</span><span class="s2">&quot;li&quot;</span><span class="p">,</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span>
        <span class="s2">&quot;&lt;li&gt;&lt;%= firstName %&gt; - &lt;%= lastName %&gt;&lt;/li&gt;&quot;</span>
    <span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">renderedContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">renderedContent</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">el</span>  <span class="o">:</span> <span class="s2">&quot;ul&quot;</span><span class="p">,</span>
  <span class="nx">subViews</span> <span class="o">:</span> <span class="p">[],</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">HumanItemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">model</span><span class="p">}));</span>
    <span class="p">},</span><span class="k">this</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Render each child view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])})</span>
<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</code></pre></div>


<p>Donc, dans ma vue principale <code>HumansView</code> j'ai ajouté une propriété <code>subViews</code>. A l'initialisation je parcours la collection et j'instancie autant de sous-vues que de modèles.</p>

<p>Maintenant, je souhaite instancier une 2ème fois <code>HumansView</code> avec une nouvelle collection ayant un contenu différent pour pouvoir afficher un contenu de ma liste différent selon les cas :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>
<span class="kd">var</span> <span class="nx">humansView2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>

<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</code></pre></div>


<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-05.png" alt="Alt &quot;BBOM-05.png&quot;" /></p>

<p><strong>Arghhh!</strong> ... :) <code>subViews</code> est partagée entre toutes les instances de <code>HumansView</code>, donc les vues s'ajoutent pour toutes les instances.</p>

<h3>Solution</h3>

<p>En fait, il suffit de déclarer <code>subViews</code> dans la méthode <code>initialize</code> de cette manière :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">el</span>  <span class="o">:</span> <span class="s2">&quot;ul&quot;</span><span class="p">,</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">HumanItemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">model</span><span class="p">}));</span>
    <span class="p">},</span><span class="k">this</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Render each child view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<h3>De la même manière ...</h3>

<p>J'aimerais pouvoir afficher mes 2 instances de <code>HumansView</code> en même temps et à 2 endroits différents dans ma page HTML :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;list1&quot;</span><span class="nt">&gt;&lt;/ul&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;list2&quot;</span><span class="nt">&gt;&lt;/ul&gt;</span>
</code></pre></div>


<p>Dans ce cas là, il suffit de supprimer la référence <code>el  : "ul"</code> qui elle aussi, je le rappelle est partagée avec toutes les instances de <code>HumansView</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">HumansView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">HumanItemView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span><span class="nx">model</span><span class="p">}));</span>
    <span class="p">},</span><span class="k">this</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">render</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Render each child view</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>Et d'instancier nos 2 vues de cette façon :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">humansView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">el</span><span class="o">:</span><span class="s2">&quot;#list1&quot;</span><span class="p">,</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">bob</span><span class="p">,</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>
<span class="kd">var</span> <span class="nx">humansView2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumansView</span><span class="p">({</span><span class="nx">el</span><span class="o">:</span><span class="s2">&quot;#list2&quot;</span><span class="p">,</span><span class="nx">collection</span><span class="o">:</span><span class="k">new</span> <span class="nx">Humans</span><span class="p">([</span><span class="nx">john</span><span class="p">,</span><span class="nx">jane</span><span class="p">])});</span>

<span class="nx">humansView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="nx">humansView2</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
</code></pre></div>


<p>Et là tout va bien :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/BBOM-06.png" alt="Alt &quot;BBOM-06.png&quot;" /></p>

<h2>Conclusion</h2>

<p>Faites attention à la manière dont vous déclarez les propriétés de vos objets. Pensez d'abord à l'utilisation que vous allez en faire : le partage entre instance est aussi un aspect intéressant, mais il ne faut jamais l'oublier, car on reprend facilement des "vieux" réflexes "à la Java" qui ne fonctionnent pas forcément pareil en JavaScript.</p>

<p>J'espère que cet article servira à certains d'entre-vous.</p>

<p>Prochain épisode, nous verrons comment "détourner" le modèle objet de Backbone et se l'approprier à d'autres fins.</p>

<p>Bon WE à tous.</p>

            <br>
            <a href="/2013/11/29/BBOM.html">comments &raquo;</a>
            <br>
            <hr style="border: 1px; border-color: #cccccc; border-style: dashed; ">
            <br>
        
    </div>

</div>

    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>