<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>React la révolution des Views</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #b8eee9;
            border-radius: 0px;
            padding: 10px 30px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
		<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <a class="label label-warning" href="/">K33G_ORG's Blog</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
    <a class="label label-warning" href="http://www.k33g.org/">me</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>React : La Révolution des Views (?) (côté front)</h1>

<blockquote><p><em>Nous parlerons de:</em></p>

<blockquote><ul>
<li><em>Installation des prérequis : Node, Express, Pulldown ...</em></li>
<li><em>Ecrire nos composants React</em></li>
<li><em>La même chose mais avec l'aide de RequireJS</em></li>
</ul>
</blockquote></blockquote>

<p>Brièvement, <strong>React</strong>, qu'est-ce que c'est ? C'est tout simplement une librairie javascript issue de chez <strong>Facebook</strong> pour développer des IHM. La particularité de React, c'est d'utiliser sa propre implémentation du Virtual DOM. Il a été développé en pensant performance, il n'adresse que la partie "View" et pour information l'ihm de la version web d'Instagram est entièrement développée avec React (et quelques parties de Facebook aussi).</p>

<p><strong>Codes sources de l'article</strong></p>

<ul>
<li>la version sans requirejs : <a href="https://github.com/k33g/hello.react/tree/without-requirejs">https://github.com/k33g/hello.react/tree/without-requirejs</a></li>
<li>la version avec requirejs : <a href="https://github.com/k33g/hello.react">https://github.com/k33g/hello.react</a></li>
</ul>


<p><em>J'ai écrit cet article en une seule passe sans m'arrêter, il mérite certainement encore quelques relectures, mais je ne résiste pas à la tentation de le publier en l'état.</em></p>

<h2>Avertissements</h2>

<h3>Attention ça peut piquer les yeux</h3>

<p>Alors, avant de commencer, il faut savoir que <strong>React</strong> propose une syntaxe "très (très)particulière" : vous allez mélanger votre code HTML (en fait c'est une sorte de XML appelé JSX) avec votre code javascript!!! Là je vais encore me prendre une brassée par quelques intégrateurs html, et peut-être même par des puristes du javascript, mais peu importe, si Facebook le fait, ça vaut peut-être au minimum le coup d'y jeter un coup d’œil. Et il est probablement temps que les 2 métiers fassent quelques pas l'un vers l'autre et réfléchisse à la manière de faire évoluer leurs métiers respectifs.</p>

<p>Notre 1er composant va ressembler à ceci :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">HelloTitle</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="err">/h1&gt;</span>
        <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Version</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">version</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
        <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;&lt;</span><span class="err">/hr&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p>Ça calme! non? ;) Prenez un peu de temps et visionnez ceci <a href="http://www.youtube.com/watch?v=x7cQ3mrcKaY">http://www.youtube.com/watch?v=x7cQ3mrcKaY</a></p>

<p><em>L'utilisation de JSX n'est pas obligatoire, vous pouvez faire du pur javascript, mais JSX est beaucoup plus simple à utiliser et facilite les travaux d'intégration.</em></p>

<h3>Attention ... again</h3>

<p>Mon javascript ne sera pas compatible tout navigateur ...</p>

<p>Je vais utiliser des espèces de "custom tags", parce que chez <strong>Google</strong> et <strong>Mozilla</strong> ils pensent que c'est l'avenir :</p>

<ul>
<li><a href="http://www.x-tags.org/">http://www.x-tags.org/</a></li>
<li><a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/#addingmarkup">http://www.html5rocks.com/en/tutorials/webcomponents/customelements/</a></li>
</ul>


<p>Et j'ai encore moins de scrupule à le faire quand <strong>Douglas Crockford</strong> en parle aussi : <a href="http://www.crockford.com/html/">http://www.crockford.com/html/</a>.</p>

<p>Si ça vous choque, ne me lisez pas ou entamons une discussion (calme ;)) et imaginons notre futur avec des <strong>React</strong>, <strong>Polymer</strong>, <strong>X-Tags</strong>, ...</p>

<p>Allez, on attaque.</p>

<h2>Pré-requis</h2>

<p>Nous allons dans un 1er temps créer la stack de travail :</p>

<h3>Création de la partie serveur : Node</h3>

<p>Nous allons utiliser le framework <strong>Express</strong> : <a href="http://expressjs.com/">http://expressjs.com/</a></p>

<p>Dans votre répertoire projet, créez un fichier <code>package.json</code> :</p>

<pre><code>{
  "name": "hello-react",
  "description": "hello-react app",
  "version": "0.0.1",
  "dependencies": {
    "express": "3.x",
    "node-uuid" : "x.x"
  }
}
</code></pre>

<p>Puis, tapez (nous sommes dans la console) <code>npm install</code> pour installer les dépendances</p>

<p><em>Remarque: node-uuid permet de générer des identifiants uniques.</em></p>

<p>Ensuite, un peu de code applicatif, c'est à dire les "API" qui nous serviront à fournir de la data à notre front js, créez dans votre répertoire un fichier <code>app.js</code> avec le code suivant:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;node-uuid&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="kd">var</span> <span class="nx">buddies</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">v1</span><span class="p">(),</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Bob Morane&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">v1</span><span class="p">(),</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Doctor Who&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">v1</span><span class="p">(),</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Fox Mulder&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">id</span> <span class="o">:</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">v1</span><span class="p">(),</span> <span class="nx">name</span> <span class="o">:</span> <span class="s2">&quot;Lady Penelope&quot;</span><span class="p">}</span>
<span class="p">];</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/public&#39;</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">());</span>

<span class="c1">// get all buddies</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">buddies</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// create a buddy</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">buddy</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span>
  <span class="nx">buddy</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">v1</span><span class="p">();</span>
  <span class="nx">buddies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">buddy</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">buddy</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
</code></pre></div>


<h3>Création de la partie front</h3>

<h4>Les librairies javascript du projet</h4>

<p>Nous allons utiliser :</p>

<p>Cette fois-ci nous allons faire plus simple que la dernière fois avec Bower), nous allons utiliser <strong>Pulldown</strong> : <a href="https://npmjs.org/package/pulldown">https://npmjs.org/package/pulldown</a> qui est un simple "downloader" de script, extrêmement pratique.</p>

<p>Pour installer Pulldown : <code>sudo npm install -g pulldown</code></p>

<p>Ensuite, créez un répertoir <code>public</code>, puis créez un fichier <code>loadjs.sh</code> que vous rendrez exécutable (<code>chmod a+x loadjs</code>) avec le contenu suivant :</p>

<pre><code># === jQuery ======================
#   http://jquery.com/
# =================================
pulldown jquery -o js/vendors

# === react =========================
#   http://facebook.github.io/react
# ===================================
pulldown "http://cdnjs.cloudflare.com/ajax/libs/react/0.8.0/JSXTransformer.js" -o js/vendors
pulldown "http://cdnjs.cloudflare.com/ajax/libs/react/0.8.0/react.min.js" -o js/vendors

# === Skeleton ======================
#   http://www.getskeleton.com/
# ===================================

pulldown "https://raw2.github.com/dhg/Skeleton/master/stylesheets/base.css" -o stylesheets
pulldown "https://raw2.github.com/dhg/Skeleton/master/stylesheets/layout.css" -o stylesheets
pulldown "https://raw2.github.com/dhg/Skeleton/master/stylesheets/skeleton.css" -o stylesheets
</code></pre>

<p>Dans le répertoire <code>public</code>, lancez <code>./loadjs.sh</code></p>

<h4>Remarques :</h4>

<ul>
<li>la partie concernant <strong>Skeleton</strong>, n'est pas obligatoire, c'est un framework css pour faire "joli"</li>
<li>si vous êtes sous <strong>Windows</strong>, pour utiliser Pulldown, créez un fichier <code>load.cmd</code>, copiez les commandes "pulldown" ci-dessus et ajoutez <code>call</code> avant chaque <code>pulldown</code>, par exemple : <code>call pulldown jquery -o js/vendors</code></li>
</ul>


<h4>Préparation de la page index.html</h4>

<p>Créez dans <code>public</code> le fichier <code>index.html</code> avec le code suivant :</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;head&gt;</span>

  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>Hello React<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;React tutorial&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;author&quot;</span> <span class="na">content=</span><span class="s">&quot;@k33g_org&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;stylesheets/base.css&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;stylesheets/skeleton.css&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;stylesheets/layout.css&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sixteen columns alpha&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Hello React<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;six columns alpha&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Buddies List<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;six columns omega&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Buddies Form<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/vendors/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/vendors/JSXTransformer.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/vendors/react.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<h2>C'est parti, on fait du React</h2>

<h3>1er composant : un titre paramétrable</h3>

<p><strong>Remarque préliminaire:</strong> nous allons faire de la transformation "online" du code React. Si vous souhaitez pré-compiler votre code pour optimiser votre web application, utilisez ceci : <a href="http://facebook.github.io/react/docs/getting-started.html#offline-transform">http://facebook.github.io/react/docs/getting-started.html#offline-transform</a>.</p>

<p>Dans <code>public</code> créez un répertoire <code>components</code>, et dans ce répertoire un fichier <code>HelloTitle.js</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>

<span class="kd">var</span> <span class="nx">HelloTitle</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="err">/h1&gt;</span>
        <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Version</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">version</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
        <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;&lt;</span><span class="err">/hr&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<p><strong>Attention: ne pas oublier <code>/** @jsx React.DOM */</code> en en-tête de fichier.</strong></p>

<ul>
<li><code>this.props.message</code> : le composant a une propriété <code>message</code>, <code>this.props</code> "porte" les propriétés du composant (de la même manière <code>version</code> est aussi une propriété du composant <code>HelloTitle</code>)</li>
<li>Non, ce n'est pas une erreur, dans le <code>return</code> de la méthode <code>render</code>, ce n'est pas une string mais bel et bien une sorte de pseudo HTML, en fait c'est plutôt du XML, il faut donc bien fermer tous les tags (comme pour <code>&lt;hr&gt;&lt;/hr&gt;</code>), dans le cas de <strong>React</strong> on parle de syntaxe <strong>JSX</strong> (<em>JavaScript XML : <a href="http://facebook.github.io/react/docs/jsx-in-depth.html">http://facebook.github.io/react/docs/jsx-in-depth.html</a></em>).</li>
</ul>


<p>Maintenant, je souhaite positionner mon composant dans ma page HTML. J'ajoute un tag <code>&lt;hello-title&gt;&lt;/hello-title&gt;</code> dans lequel viendra s'insérer le code généré de notre composant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sixteen columns alpha&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;hello-title&gt;&lt;/hello-title&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</code></pre></div>


<p><strong>Remarque :</strong> j'aurais pu tout aussi bien faire quelque chose comme ceci : <code>&lt;div id="hello-title"&gt;&lt;/div&gt;</code>, mais d'un point de vue lisibilité je préfère ma méthode.</p>

<p>Il nous reste plus qu'à écrire le bout de code qui déclenche le rendu de notre composant :</p>

<p>Créez à la racine de <code>public/js</code> un fichier <code>main.js</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>

<span class="kd">var</span> <span class="nx">messageTitle</span> <span class="o">=</span> <span class="s2">&quot;Hello World! Hello React!&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span><span class="p">;</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">HelloTitle</span> <span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="nx">messageTitle</span><span class="p">}</span> <span class="nx">version</span><span class="o">=</span><span class="p">{</span><span class="nx">version</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-title&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>


<ul>
<li><strong>Ne pas oublier</strong> <code>/** @jsx React.DOM */</code></li>
<li>C'est ici que l'on passe les valeurs des propriétés du composant</li>
<li>Si j'avais utilisé <code>&lt;div id="hello-title"&gt;&lt;/div&gt;</code>, il faudrait écrire <code>document.querySelector('#hello-title')</code> au lieu de <code>document.querySelector('hello-title')</code></li>
</ul>


<p>Retournons une dernière fois dans <code>index.html</code> pour déclarer notre composant, juste avant le tag de fermeture <code>&lt;/body&gt;</code> :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/components/HelloTitle.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/main.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>


<ul>
<li><strong>Notez bien</strong> <code>type="text/jsx"</code> dans les inclusion de script, cela permet au "transpiler" JSX d'utiliser nos scripts.</li>
</ul>


<p>Vous pouvez maintenant démarrer votre application : <code>node app.js</code> et ouvrez dans votre navigateur préféré : <a href="http://localhost:3000">http://localhost:3000</a>.</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/hello.react.001.png" alt="Alt &quot;001.png&quot;" /></p>

<h3>2 ème composant : la liste des "buddies"</h3>

<p>Nous allons afficher la liste des "buddies" fournis par notre application Express :</p>

<p>Dans <code>public/components</code>, créez un fichier <code>HelloBuddies.js</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>

  <span class="cm">/*--- Buddies List ---*/</span>
  <span class="kd">var</span> <span class="nx">HelloBuddies</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

    <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">data</span> <span class="o">:</span> <span class="p">[],</span> <span class="nx">message</span> <span class="o">:</span> <span class="s2">&quot;...&quot;</span><span class="p">};</span>
    <span class="p">},</span>
    <span class="nx">getAllBuddies</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buddies</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">data</span> <span class="o">:</span> <span class="nx">buddies</span><span class="p">,</span> <span class="nx">message</span> <span class="o">:</span> <span class="nb">Date</span><span class="p">()});</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

    <span class="p">},</span>
    <span class="nx">componentWillMount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getAllBuddies</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">pollInterval</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">buddyItem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">buddy</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span>
           <span class="p">{</span><span class="nx">buddy</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="p">{</span><span class="s2">&quot; &quot;</span><span class="p">}</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">buddy</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/strong&gt;</span>
        <span class="o">&lt;</span><span class="err">/li&gt;);</span>
      <span class="p">});</span>

      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Buddies</span> <span class="nx">List</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
          <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/strong&gt;</span>
          <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="nx">buddyItem</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="err">/ul&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre></div>


<ul>
<li><code>getInitialState()</code> est une méthode de React qui permet de définit l'état initial des variables "attachées" aux composants</li>
<li>Pour ensuite modifier ces variables on utilisera <code>this.setState({le_nom_de_la_variable:valeur})</code></li>
<li>Pour lire le contenu de ces variables : <code>this.state.le_nom_de_la_variable</code></li>
<li><code>getAllBuddies()</code> est une fonction utilisateur : c'est elle qui va faire une requête de type REST au serveur pour obtenir la liste des buddies et modifier <code>this.state.data</code> quand elle recevra les données</li>
<li><code>componentWillMount()</code> est une méthode React, on peut l'assimiler à une sorte d'<code>init()</code> ou <code>initialize()</code> qui est déclenchée à la création du composant. Il existe aussi <code>componentDidMount()</code> une fois que le composant est "ancré" dans le DOM. Dans <code>componentWillMount()</code> nous demandons d'exécuter <code>getAllBuddies()</code>  toutes les N (<code>this.props.pollInterval</code>) millisecondes. Ainsi, à chaque fois que les variables (dans <code>state</code>) du composant sont modifiées, la méthode <code>render</code> sera appelée.</li>
</ul>


<p>Nous modifions notre code html de la manière suivante avec le tag <code>&lt;hello-buddies&gt;&lt;/hello-buddies&gt;</code> :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sixteen columns alpha&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;hello-title&gt;&lt;/hello-title&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;six columns alpha&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;hello-buddies&gt;&lt;/hello-buddies&gt;</span>
  <span class="nt">&lt;/div&gt;</span>  
  <span class="c">&lt;!-- ... --&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</code></pre></div>


<p>Tout en n'oubliant pas de déclarer notre nouveau composant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/components/HelloTitle.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/components/HelloBuddies.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/main.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>


<p>Il ne reste plus qu'à déclarer le composant et le rendu de celui-ci dans <code>main.js</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>

<span class="kd">var</span> <span class="nx">messageTitle</span> <span class="o">=</span> <span class="s2">&quot;Hello World! Hello React!&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span><span class="p">;</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">HelloTitle</span> <span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="nx">messageTitle</span><span class="p">}</span> <span class="nx">version</span><span class="o">=</span><span class="p">{</span><span class="nx">version</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-title&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">HelloBuddies</span> <span class="nx">pollInterval</span><span class="o">=</span><span class="p">{</span><span class="mi">1000</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-buddies&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>


<p><strong>Remarque:</strong> notez la déclaration de la valeur de l'intervalle de pooling au sein du composant (<code>pollInterval</code>)</p>

<p>Vous pouvez rafraîchir votre page :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/hello.react.002.png" alt="Alt &quot;002.png&quot;" /></p>

<h3>3 ème et dernier composant : le formulaire pour créer des buddies</h3>

<p>Dans <code>public/components</code>, créez un fichier <code>HelloBuddyForm.js</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>

<span class="kd">var</span> <span class="nx">HelloBuddyForm</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">data</span> <span class="o">:</span> <span class="p">[],</span> <span class="nx">message</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">};</span>
  <span class="p">},</span>

  <span class="nx">handleSubmit</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="kc">false</span><span class="p">;}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="nx">message</span> <span class="o">:</span> <span class="s2">&quot;Please wait ...&quot;</span>
    <span class="p">});</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;buddies&quot;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span><span class="p">},</span>
      <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buddy</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
          <span class="nx">message</span> <span class="o">:</span> <span class="nx">buddy</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; added!&quot;</span>
        <span class="p">});</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">focus</span><span class="p">();</span>

      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">},</span>


  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Buddy</span> <span class="nx">Form</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
        <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="o">/&gt;</span>

          <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Add Buddy&quot;</span> <span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="err">/br&gt;</span>
          <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/strong&gt;</span>
        <span class="o">&lt;</span><span class="err">/form&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<ul>
<li>Dans le code JSX du composant, si l'on souhaite que les éléments du DOM soit accessibles à partir du code javascript du composant, il faut leur ajouter un attribut <code>ref</code> avec le nom du composant : <code>&lt;input type="text" placeholder="name" ref="name"/&gt;</code> et ensuite React vous permet d'interagir avec de la manière suivante : <code>this.refs.name.getDOMNode()</code></li>
<li>Donc dans notre exemple nous avons un champ texte <code>&lt;input&gt;</code> avec une "référence" <code>name</code> et nous pouvons accéder à l'ensemble de ses propriétés (et les modifier) et de ses méthodes (ex: <code>focus()</code>)</li>
</ul>


<p>Une fois notre composant écrit, nous allons le déclarer dans la page html avec le tag <code>&lt;hello-buddy-form&gt;</code>:</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sixteen columns alpha&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;hello-title&gt;&lt;/hello-title&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;six columns alpha&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;hello-buddies&gt;&lt;/hello-buddies&gt;</span>
  <span class="nt">&lt;/div&gt;</span>  
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;six columns omega&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;hello-buddy-form&gt;&lt;/hello-buddy-form&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</code></pre></div>


<p>Et en ajoutant :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/components/HelloTitle.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/components/HelloBuddies.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/components/HelloBuddyForm.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/jsx&quot;</span> <span class="na">src=</span><span class="s">&quot;js/main.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>


<p>Et enfin dans <code>main.js</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>

<span class="kd">var</span> <span class="nx">messageTitle</span> <span class="o">=</span> <span class="s2">&quot;Hello World! Hello React!&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span><span class="p">;</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">HelloTitle</span> <span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="nx">messageTitle</span><span class="p">}</span> <span class="nx">version</span><span class="o">=</span><span class="p">{</span><span class="nx">version</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-title&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">HelloBuddies</span> <span class="nx">pollInterval</span><span class="o">=</span><span class="p">{</span><span class="mi">1000</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-buddies&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">HelloBuddyForm</span><span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-buddy-form&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>


<p>Vous pouvez rafraîchir votre page :</p>

<p><img src="https://github.com/k33g/k33g.github.com/raw/master/images/hello.react.003.png" alt="Alt &quot;003.png&quot;" /></p>

<p>Voilà. Nous avons fais un 1er tour rapide. Mais encore une ou deux petites choses ...</p>

<h2>On fait encore du React, mais avec RequireJS</h2>

<p>Cela peut vite devenir le foutoir, quand les composants vont se multiplier. Donc vous aurez certainement envie de structurer tout ça avec RequireJS. Il se trouve qu'il existe un plugin pour pouvoir utiliser JSX : <a href="https://github.com/seiffert/require-jsx">https://github.com/seiffert/require-jsx</a> et ainsi de définir les dépendances (et chargement) de nos composants de cette manière : <code>'jsx!components/nom_du_composant'</code>.</p>

<h3>Nouvelles dépendances</h3>

<p>Donc dans votre petit script <code>loadjs.sh</code> vous pouvez ajouter 2 lignes :</p>

<pre><code>pulldown require.js -o js/vendors
pulldown "https://raw2.github.com/seiffert/require-jsx/master/jsx.js" -o js/vendors
</code></pre>

<p>Vous pouvez à nouveau relancer votre script pour récupérer les 2 nouvelles librairies</p>

<p>Ensuite dans votre page <code>index.html</code>, supprimer les inclusion de script et remplacez les par  <code>&lt;script data-main="js/main" src="js/vendors/require.min.js"&gt;&lt;/script&gt;</code></p>

<h3>On refait <code>main.js</code></h3>

<p>Allez ensuite remplacer le contenu de <code>main.js</code> par ceci :</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">requirejs</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
  <span class="nx">baseUrl</span> <span class="o">:</span> <span class="s2">&quot;js/&quot;</span><span class="p">,</span>
  <span class="nx">paths</span>   <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;jquery&quot;</span>        <span class="o">:</span> <span class="s2">&quot;vendors/jquery.min&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jsx&quot;</span>           <span class="o">:</span> <span class="s2">&quot;vendors/jsx&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JSXTransformer&quot;</span><span class="o">:</span> <span class="s2">&quot;vendors/JSXTransformer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;react&quot;</span>         <span class="o">:</span> <span class="s2">&quot;vendors/react.min&quot;</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">require</span><span class="p">([</span>
  <span class="s1">&#39;jsx!application/Application&#39;</span>
<span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">Application</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">Application</span><span class="p">.</span><span class="nx">initialize</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div>


<h3>Création de <code>Application.js</code></h3>

<p>Créez un répertoire <code>application</code> dans <code>public/js/</code> et dans ce répertoire un fichier <code>Application.js</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>
<span class="nx">define</span><span class="p">([</span>
    <span class="s1">&#39;jquery&#39;</span>
  <span class="p">,</span> <span class="s1">&#39;react&#39;</span>
  <span class="p">,</span> <span class="s1">&#39;jsx!components/HelloTitle&#39;</span>
  <span class="p">,</span> <span class="s1">&#39;jsx!components/HelloBuddies&#39;</span>
  <span class="p">,</span> <span class="s1">&#39;jsx!components/HelloBuddyForm&#39;</span>

<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">React</span><span class="p">,</span> <span class="nx">HelloTitle</span><span class="p">,</span> <span class="nx">HelloBuddies</span><span class="p">,</span> <span class="nx">HelloBuddyForm</span><span class="p">){</span>

  <span class="kd">var</span> <span class="nx">Application</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">initialize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">messageTitle</span> <span class="o">=</span> <span class="s2">&quot;Hello World! Hello React!&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span><span class="p">;</span>

      <span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">HelloTitle</span> <span class="nx">message</span><span class="o">=</span><span class="p">{</span><span class="nx">messageTitle</span><span class="p">}</span> <span class="nx">version</span><span class="o">=</span><span class="p">{</span><span class="nx">version</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-title&#39;</span><span class="p">)</span>
      <span class="p">);</span>

      <span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">HelloBuddies</span> <span class="nx">pollInterval</span><span class="o">=</span><span class="p">{</span><span class="mi">1000</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">,</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-buddies&#39;</span><span class="p">)</span>
      <span class="p">);</span>

      <span class="nx">React</span><span class="p">.</span><span class="nx">renderComponent</span><span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">HelloBuddyForm</span><span class="o">/&gt;</span><span class="p">,</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;hello-buddy-form&#39;</span><span class="p">)</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">Application</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>


<h3>Modifions tous nos composants</h3>

<p>C'est assez simple à faire, globalement nous avons juste à les encapsuler dans une déclaration <code>define</code> sans oublier la directive <code>/** @jsx React.DOM */</code> :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>
<span class="nx">define</span><span class="p">([</span><span class="s2">&quot;react&quot;</span><span class="p">,</span><span class="s2">&quot;jquery&quot;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">React</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">MyComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
    <span class="c1">// foo ...</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">MyComponent</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>


<p>Nous aurons donc :</p>

<h4>HelloTitle</h4>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>

<span class="nx">define</span><span class="p">([</span><span class="s2">&quot;react&quot;</span><span class="p">,</span><span class="s2">&quot;jquery&quot;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">React</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">HelloTitle</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="err">/h1&gt;</span>
          <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Version</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">version</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/h3&gt;</span>
          <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;&lt;</span><span class="err">/hr&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">HelloTitle</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>


<h4>HelloBuddies</h4>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>
<span class="nx">define</span><span class="p">([</span><span class="s2">&quot;react&quot;</span><span class="p">,</span><span class="s2">&quot;jquery&quot;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">React</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">HelloBuddies</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

    <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">data</span> <span class="o">:</span> <span class="p">[],</span> <span class="nx">message</span> <span class="o">:</span> <span class="s2">&quot;...&quot;</span><span class="p">};</span>
    <span class="p">},</span>
    <span class="nx">getAllBuddies</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;buddies&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buddies</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">data</span> <span class="o">:</span> <span class="nx">buddies</span><span class="p">,</span> <span class="nx">message</span> <span class="o">:</span> <span class="nb">Date</span><span class="p">()});</span>
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

    <span class="p">},</span>
    <span class="nx">componentWillMount</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getAllBuddies</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">pollInterval</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">buddyItem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">buddy</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span>
           <span class="p">{</span><span class="nx">buddy</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="p">{</span><span class="s2">&quot; &quot;</span><span class="p">}</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">buddy</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/strong&gt;</span>
        <span class="o">&lt;</span><span class="err">/li&gt;);</span>
      <span class="p">});</span>

      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Buddies</span> <span class="nx">List</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
          <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/strong&gt;</span>
          <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="nx">buddyItem</span><span class="p">}</span>
          <span class="o">&lt;</span><span class="err">/ul&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">HelloBuddies</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>


<h4>HelloBuddyForm</h4>

<div class="highlight"><pre><code class="javascript"><span class="cm">/** @jsx React.DOM */</span>
<span class="nx">define</span><span class="p">([</span><span class="s2">&quot;react&quot;</span><span class="p">,</span><span class="s2">&quot;jquery&quot;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">React</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">HelloBuddyForm</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

    <span class="nx">getInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">data</span> <span class="o">:</span> <span class="p">[],</span> <span class="nx">message</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">};</span>
    <span class="p">},</span>

    <span class="nx">handleSubmit</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="kc">false</span><span class="p">;}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
        <span class="nx">message</span> <span class="o">:</span> <span class="s2">&quot;Please wait ...&quot;</span>
      <span class="p">});</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;buddies&quot;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">name</span> <span class="o">:</span> <span class="nx">name</span><span class="p">},</span>
        <span class="nx">dataType</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buddy</span><span class="p">){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
            <span class="nx">message</span> <span class="o">:</span> <span class="nx">buddy</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; added!&quot;</span>
          <span class="p">});</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">getDOMNode</span><span class="p">().</span><span class="nx">focus</span><span class="p">();</span>

        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
      <span class="p">});</span>

      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span>


    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Buddy</span> <span class="nx">Form</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
          <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleSubmit</span><span class="p">}</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="o">/&gt;</span>

            <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Add Buddy&quot;</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="err">/br&gt;</span>
            <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/strong&gt;</span>
          <span class="o">&lt;</span><span class="err">/form&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">HelloBuddyForm</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>


<p>... That's all!</p>

<p>Amusez vous bien! Retours et discussions bienvenus!</p>

<p><em>PS: ça marche aussi très bien avec Backbone : <a href="http://www.thomasboyt.com/2013/12/17/using-reactjs-as-a-backbone-view.html">http://www.thomasboyt.com/2013/12/17/using-reactjs-as-a-backbone-view.html</a></em></p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'React la révolution des Views';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>10 May 2014</span> &raquo; <a href="/2014/05/10/ATOM-SHELL.html">Atom-shell, javascript everywhere</a></li>
            
              <li><span>09 May 2014</span> &raquo; <a href="/2014/05/09/NPM-NODE-CLI.html">Faites vos outils avec npm et node</a></li>
            
              <li><span>04 May 2014</span> &raquo; <a href="/2014/05/04/MIXIT-2014.html">MixITFR2014</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>