<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Faites vos outils avec npm et node</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #444444;
            border-radius: 0px;
            padding: 10px 30px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
		<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <a class="label label-warning" href="/">K33G_ORG's Blog</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
    <a class="label label-warning" href="http://www.k33g.org/">me</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>Faites vos outils avec npm et node</h1>

<p>Lorsque je code, j'ai souvent des tâches répétitives (quel que soit le langage), ie:</p>

<ul>
<li>écrire des modèles et des collections Backbone</li>
<li>écrire des modèles Play</li>
<li>écrire des routes pour Express.js</li>
<li>...</li>
</ul>


<p>Nul doute, que vous avez énormément d'autres exemples en tête. L'outil du moment pour régler ce type de problème est <a href="http://yeoman.io/">Yeoman</a> (oui il y en a d'autres, mais Yeoman c'est "hype" ;)) et ensuite, ou vous avez de la chance, ou il faut écrire le plugin dont vous avez besoin. Dans certains cas, surtout si vous n'avez pas besoin de quelque chose de complexe, vous pouvez rapidement écrire un utilitaire avec uniquemnt node et npm.</p>

<h2>Spécifications (par exemple)</h2>

<p>Je passe mon temps à écrire des modèles et des collections Backbone qui ressemblent à ceci :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/*--- Human Model ---*/</span>
<span class="kd">var</span> <span class="nx">HumanModel</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">defaults</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
      <span class="k">return</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="nx">urlRoot</span> <span class="o">:</span> <span class="s2">&quot;humans&quot;</span>
<span class="p">});</span>

<span class="cm">/*--- Humans Collection ---*/</span>
<span class="kd">var</span> <span class="nx">HumansCollection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;humans&quot;</span><span class="p">,</span>
  <span class="nx">model</span><span class="o">:</span> <span class="nx">HumanModel</span>
<span class="p">});</span>
</code></pre></div>


<p>Et j'aimerais aller plus vite, juste taper <code>bb Human</code> et obtenir mon fichier généré.</p>

<h2>Juste fais-le ...</h2>

<h3>package.json</h3>

<p>Commencez par créer un répertoire <code>bbtools</code>. Ensuite dans ce répertoire, créez un fichier <code>package.json</code> avec le contenu suivant :</p>

<pre><code>{
 "name": "bbtools",
 "version": "0.0.0",
 "bin": { "bb": "bb.js"},
 "dependencies": {
   "underscore": "1.6.0"
  }
}
</code></pre>

<p>L'objectif étant de disposer d'une commande <code>bb</code> qui exécutera le fichier <code>bb.js</code>. Notez <code>"underscore": "1.6.0"</code>, nous allons nous servir des capacités de "templating" de la librairie Underscore</p>

<h3>Notre template</h3>

<p>Créez (dans le même répertoire) un fichier <code>bb.tpl</code> avec le contenu suivant :</p>

<div class="highlight"><pre><code class="javascript"><span class="cm">/*--- &lt;%= modelName %&gt; Model ---*/</span>
<span class="kd">var</span> <span class="o">&lt;%=</span> <span class="nx">modelName</span> <span class="o">%&gt;</span><span class="nx">Model</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">defaults</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(){</span>
      <span class="k">return</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="nx">urlRoot</span> <span class="o">:</span> <span class="s2">&quot;&lt;%= modelName.toLowerCase() %&gt;s&quot;</span>
<span class="p">});</span>

<span class="cm">/*--- &lt;%= modelName %&gt;s Collection ---*/</span>
<span class="kd">var</span> <span class="o">&lt;%=</span> <span class="nx">modelName</span> <span class="o">%&gt;</span><span class="nx">sCollection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;&lt;%= modelName.toLowerCase() %&gt;s&quot;</span><span class="p">,</span>
  <span class="nx">model</span><span class="o">:</span> <span class="o">&lt;%=</span> <span class="nx">modelName</span> <span class="o">%&gt;</span><span class="nx">Model</span>
<span class="p">});</span>
</code></pre></div>


<h3>Le code applicatif</h3>

<p>Créez (dans le même répertoire) un fichier <code>bb.js</code> avec le contenu suivant :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>

<span class="nx">require</span><span class="p">.</span><span class="nx">extensions</span><span class="p">[</span><span class="s1">&#39;.tpl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">tpl</span>  <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./bb.tpl&quot;</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">model_name</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span> <span class="o">+</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">model_name</span> <span class="o">+</span> <span class="s2">&quot;.js&quot;</span>
  <span class="p">,</span> <span class="nx">tpl</span><span class="p">({</span><span class="nx">modelName</span> <span class="o">:</span><span class="nx">model_name</span><span class="p">})</span>
<span class="p">);</span>
</code></pre></div>


<h4>Explications</h4>

<ul>
<li><code>#!/usr/bin/env node</code> : rendra le fichier exécutable</li>
<li><code>_.template(require("./bb.tpl"))</code> va lire notre fichier <code>bb.tpl</code> et le transforme en objet template pour Underscore</li>
<li><code>process.cwd()</code> permet de connaître le répertoire d'où l'on appelle la commande <code>bb</code></li>
<li><code>process.argv[2]</code> permet d'obtenir le 1er argument passé à la commande <code>bb</code> (comme par exemple <code>bb Human</code>)</li>
<li><code>tpl({modelName :model_name })</code> : on "explique" au template que l'on passe le contenu de <code>model_name</code> à <code>modelName</code> définie dans le template</li>
</ul>


<h3>Enregistrez votre outil</h3>

<p>Pour que votre nouvelle commande soit disponible "partout" (pouvoir l'appeler de n'importe quel répertoire), tapez la commande suivante (on est toujours dans notre répertoire de développement) :</p>

<pre><code>npm link
</code></pre>

<p>Si ce n'est pas déjà fait, cela va télécharger les dépendances nécessaires (underscrore dans notre cas), puis créer un "lien symbolique" vers votre fichier <code>bb.js</code></p>

<p>Maintenant, de n'importe où, dans une console (terminal), vous pouvez taper <code>bb Animal</code> et cela vous génèrera votre fichier <code>Animal.js</code> avec votre modèle et votre collection.</p>

<p>Voilà, c'est très simple et utile. Si vous sentez que votre outil devient une usine à gaz, passez quand même à Yeoman ;).</p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'Faites vos outils avec npm et node';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>10 May 2014</span> &raquo; <a href="/2014/05/10/ATOM-SHELL.html">Atom-shell, javascript everywhere</a></li>
            
              <li><span>04 May 2014</span> &raquo; <a href="/2014/05/04/MIXIT-2014.html">MixITFR2014</a></li>
            
              <li><span>28 Apr 2014</span> &raquo; <a href="/2014/04/28/NODE-PERFS.html">optimisation de performances avec node et express</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>