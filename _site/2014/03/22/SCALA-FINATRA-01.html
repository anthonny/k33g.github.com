<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>J'apprends Scala avec Finatra</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #b8eee9;
            border-radius: 0px;
            padding: 10px 30px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
		<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <a class="label label-warning" href="/">K33G_ORG's Blog</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
    <a class="label label-warning" href="http://www.k33g.org/">me</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>J'apprends Scala avec Finatra: Part I</h1>

<p>Je suis obligé de reconnaître que je "trolle" sur Scala sans réellement en faire. Mais à chaque fois que j'ai essayé dans faire, je trouvais ça un peu obscur. Il y a peu <a href="https://twitter.com/loic_d">@loic_d</a>, connaissant mon intérêt pour les micro-frameworks m'a poussé ce lien <a href="http://finatra.info/">http://finatra.info/</a>. <strong>Finatra</strong> est un micro-framework web en Scala réalisé chez <strong>Twitter</strong>. En lisant le code d'exemple sur la home page j'ai trouvé ça tout de suite très lisible.</p>

<div class="highlight"><pre><code class="scala"><span class="k">class</span> <span class="nc">HelloWorld</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>
  
  <span class="n">get</span><span class="o">(</span><span class="s">&quot;/hello/:name&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="n">request</span><span class="o">.</span><span class="n">routeParams</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;default user&quot;</span><span class="o">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">plain</span><span class="o">(</span><span class="s">&quot;hello &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">).</span><span class="n">toFuture</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>


<p><strong>Tiens, on peut faire du code Scala pas ésotérique !?</strong>. En allant faire un tour ici <a href="http://twitter.github.io/scala_school/">Scala School</a> (toujours chez Twitter, tiens tiens!), cela semble se confirmer.</p>

<p>Du coup (et vu que de grosses boutiques s'y collent), je me suis dit "redonnons une chance à Scala" ... ou plutôt, je me redonne une chance de comprendre ;).</p>

<p>Je vais donc juste faire un petit rappel sur la manière de faire son premier projet Scala et sa première classe et ensuite nous passerons directement à la réalisation d'une application web avec <strong>Finatra</strong> avec un mini service json (mais mini mini).</p>

<p>Nous verrons aussi que nous pouvons facilement mettre en œuvre une fonctionnalité de rechargement et compilation automatique de l'application lorsque nous modifions le code.</p>

<p><em>Remarque: avez vous vu dans le code le mot clé <code>toFuture</code> ? Finatra est un framework web asynchrone.</em></p>

<h2>Avertissement</h2>

<p>Alors, attention, moi aussi j'apprends Scala (et Finatra), donc je peux dire des choses choquantes (ou peut-être fausses). Ce blog est propulsé par <strong>GitHub</strong> par ici : <a href="https://github.com/k33g/k33g.github.com">https://github.com/k33g/k33g.github.com</a>, ce qui veut dire que vous pouvez faire des <a href="https://help.github.com/articles/using-pull-requests">pull requests</a> sur ce que j'écris pour m'aider à m'améliorer (merci d'avance), vous pouvez même déclarer des <a href="https://github.com/k33g/k33g.github.com/issues">issues</a>, mais je préfère les PR (comme ça vous bossez pour moi ;) ). Par contre il vous faudra un compte <strong>GitHub</strong> (et c'est l'occasion de le faire tout de suite si vous n'en avez pas).</p>

<h2>Pré-requis</h2>

<ul>
<li>Vous devez installer Scala (facile)</li>
<li>Vous devez installer <strong>sbt</strong> <a href="http://www.scala-sbt.org/release/docs/Getting-Started/Setup.html#installing-sbt">http://www.scala-sbt.org/release/docs/Getting-Started/Setup.html#installing-sbt</a> (facile aussi)</li>
</ul>


<p><em>Remarque: sbt pour Scala Build Tools est un utilitaire destiner à vous faciliter la vie pour vos projets Scala.</em></p>

<h2>Rappel : Classes &amp; Objets</h2>

<p>Avant de rentrer dans le dur, nous allons juste un peu "désacraliser" Scala et apprendre à faire une petite classe, pour bien vérifier que finalement, c'est simple.</p>

<h3>Création du projet</h3>

<p>Tout d'abord, nous allons créer une rapide structure de projet Scala, compréhensible par <strong>sbt</strong>, ce qui nous permettra de compiler notre code facilement.</p>

<p>Créez l'arborescence suivante (adaptez selon vos besoins) : (là on le fait à la main mais il existe des outils rassurez vous)</p>

<pre><code> demo
 |--src
    |--main
       |--scala
          |--org
             |--k33g
                |--models
</code></pre>

<h4>Référence(s) pour aller plus loin sur la notion de création de projet</h4>

<ul>
<li><a href="http://scalatutorials.com/beginner/2013/07/18/getting-started-with-sbt/">http://scalatutorials.com/beginner/2013/07/18/getting-started-with-sbt/</a></li>
</ul>


<h3>Programme principal</h3>

<p>Dans <code>demo/src/main/scala/org/k33g/</code> créez le fichier <code>Demo.scala</code> <em>(remarquez que le nom <code>Demo</code> versus le nom du répertoire <code>demo</code>, ce n'est pas obligatoire, mais c'est plus propre)</em> avec le code suivant :</p>

<div class="highlight"><pre><code class="scala"><span class="k">package</span> <span class="nn">org.k33g</span>

<span class="k">object</span> <span class="nc">Demo</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Hello World!&quot;</span><span class="o">)</span>

<span class="o">}</span>
</code></pre></div>


<p>Sauvegardez, ouvrez votre terminal ou votre console, allez dans <code>demo</code> (<code>cd demo</code>) et tapez <code>sbt run</code> (et validez). Ça va mouliner un peu (Scala n'est pas super green au démarrage), pour finir par vous afficher un splendide :</p>

<pre><code>Hello World!
</code></pre>

<p><code>\o/</code></p>

<h3>First Class : <code>Human</code></h3>

<p>Dans <code>demo/src/main/scala/org/k33g/models</code> créez le fichier <code>Human.scala</code> avec le code suivant :</p>

<div class="highlight"><pre><code class="scala"><span class="k">package</span> <span class="nn">org.k33g.models</span>

<span class="k">class</span> <span class="nc">Human</span><span class="o">(</span><span class="k">val</span> <span class="n">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">sayHello</span><span class="o">()</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">firstName</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">lastName</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>


<p>Nous venons juste de créer une classe <code>Human</code> avec 2 "propriétés" <code>firstName</code> et <code>lastName</code> et une méthode <code>sayHello</code> qui retourne une chaîne de caractères. Ce n'est pas trop violent, et vous remarquez que la définition des attributs de la classe par passage de paramètre au constructeur est assez élégante (je ne peux pas troller sur Scala constamment).</p>

<p>Modifiez ensuite le précédent fichier <code>Demo.scala</code> :</p>

<div class="highlight"><pre><code class="scala"><span class="k">package</span> <span class="nn">org.k33g</span>

<span class="k">import</span> <span class="nn">org.k33g.models._</span>

<span class="k">object</span> <span class="nc">Demo</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>

  <span class="k">var</span> <span class="n">bob</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Human</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;Morane&quot;</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="n">bob</span><span class="o">.</span><span class="n">sayHello</span><span class="o">())</span>

<span class="o">}</span>
</code></pre></div>


<p>Toujours dans <code>demo</code> lancez à nouveau un <code>sbt run</code>, vous allez obtenir :</p>

<pre><code>Hello Bob Morane
</code></pre>

<p>Voilà, vous savez tout ;), Scala c'est facile ... On peut maintenant aller faire une application web en Scala (avec Finatra).</p>

<h2>Ma première application Finatra</h2>

<h3>Installer Finatra</h3>

<ul>
<li>Téléchargez <a href="https://github.com/twitter/finatra/archive/1.5.2.zip">https://github.com/twitter/finatra/archive/1.5.2.zip</a></li>
<li>Dé-zippez</li>
<li>Mettez à jour votre <code>PATH</code> avec le chemin vers Finatra</li>
</ul>


<p>Chez moi (sous OSX), cela ressemble à ça :</p>

<pre><code>FINATRA_HOME=/Users/k33g_org/finatra-1.5.2
export FINATRA_HOME
export PATH=$PATH:$FINATRA_HOME
</code></pre>

<h3>Générez votre 1er projet</h3>

<ul>
<li>Tapez ceci : <code>finatra new org.k33g.DemoWeb</code></li>
<li>A la question <code>Install Bower components? (y/n)</code> répondez <code>y</code> (cela va permettre par défaut de télécharger <strong>Bootstrap</strong> et <strong>jQuery</strong>)</li>
</ul>


<p>Vous obtenez donc votre squelette de projet dans le répertoire <code>DemoWeb</code>. Mais avant de lancez quoique ce soit procédons à quelques réglages.</p>

<h4>Préparez votre "stack front" avec Bower : un peu de javascript</h4>

<p>Allez dans <code>DemoWeb</code> et modifiez <code>bower.json</code> en lui ajoutant 2 dépendances : <code>backbone</code> et <code>underscore</code>, de cette manière :</p>

<pre><code>{
  "name": "DemoWeb",
  "version": "0.0.1",
  "license": "MIT",
  "private": true,
  "ignore": [
    "**/.*",
    "node_modules",
    "bower_components",
    "test",
    "tests"
  ],
  "dependencies": {
    "bootstrap" : "twbs/bootstrap",
    "backbone" : null,
    "underscore" : null
  }
}
</code></pre>

<p>Ensuite, lancez <code>bower update</code> (dans <code>DemoWeb</code>) et les frameworks javascript <strong>Backbone</strong> et <strong>Underscore</strong> seront téléchargés.</p>

<h4>Modifiez (préparez) la page d'accueil</h4>

<p>Modifiez <code>src/main/resources/public/index.html</code> de cette façon :</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;icon&quot;</span> <span class="na">type=</span><span class="s">&quot;image/x-icon&quot;</span> <span class="na">href=</span><span class="s">&quot;/favicon.ico&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Demo<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;/components/bootstrap/dist/css/bootstrap.css&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;header&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Je me la joue en Scala<span class="nt">&lt;/h1&gt;</span>
      <span class="nt">&lt;/header&gt;</span>

    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/components/jquery/dist/jquery.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/components/underscore/underscore.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;/components/backbone/backbone.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<h4>Modifiez le code de démarrage de l'application</h4>

<p>Ouvrez <code>src/main/scala/org/k33G/DemoWeb/App.scala</code> et simplifiez le code de cette manière :</p>

<div class="highlight"><pre><code class="scala"><span class="k">package</span> <span class="nn">org.k33g.DemoWeb</span>

<span class="k">import</span> <span class="nn">com.twitter.finatra._</span>
<span class="k">import</span> <span class="nn">com.twitter.finatra.ContentType._</span>

<span class="k">object</span> <span class="nc">App</span> <span class="k">extends</span> <span class="nc">FinatraServer</span> <span class="o">{</span>

  <span class="k">class</span> <span class="nc">MyApp</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>

    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
      <span class="n">render</span><span class="o">.</span><span class="n">static</span><span class="o">(</span><span class="s">&quot;index.html&quot;</span><span class="o">).</span><span class="n">toFuture</span>
    <span class="o">}</span>

  <span class="o">}</span>

  <span class="n">register</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyApp</span><span class="o">())</span>
<span class="o">}</span>
</code></pre></div>


<p>Nous nous contentons donc de dire qu'il faut afficher <code>index.html</code> si l'on appelle la racine du site <code>/</code> dans le navigateur.</p>

<h4>Il est temps de tester</h4>

<p>Il suffit de lancer la commande <code>sbt run</code>. La console <strong>sbt</strong> "va compiler" votre application et ensuite vous notifier que vous pouvez vous connecter : <code>finatra: http server started on port: :7070</code>, ouvrez donc <a href="http://localhost:7070/">http://localhost:7070/</a>. Tout roule ? On passe donc à la suite. Arrêtez l'application : <code>Ctrl + c</code>.</p>

<h2>Création d'un service json</h2>

<p>Nous allons juste créer une classe <code>Human</code> (encore!) et nous la "publierons" au format json pour le navigateur.</p>

<h3>Création de la classe Human</h3>

<p>Tout d'abord créez un répertoire <code>models</code> dans le répertoire <code>src/main/scala/org/k33g</code>. Dans ce répertoire, créez une classe <code>Human.scala</code> avec le code source suivant :</p>

<div class="highlight"><pre><code class="scala"><span class="k">package</span> <span class="nn">org.k33g.models</span>

<span class="k">class</span> <span class="nc">Human</span><span class="o">(</span><span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div>


<h3>Création de notre service</h3>

<p>Ouvrez à nouveau <code>src/main/scala/org/k33g/DemoWeb/App.scala</code>, nous allons rajouter une "routes" qui fournira du jso, au navigateur :</p>

<p>Premièrement, pensez à importer les modèles : <code>import org.k33g.models._</code> et ajoutez ceci :</p>

<div class="highlight"><pre><code class="scala"><span class="n">get</span><span class="o">(</span><span class="s">&quot;/humans/:id&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
  <span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="n">request</span><span class="o">.</span><span class="n">routeParams</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">bob</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Human</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;Morane&quot;</span><span class="o">)</span>

  <span class="n">render</span><span class="o">.</span><span class="n">json</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span>
    <span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">id</span><span class="o">,</span> 
    <span class="s">&quot;firstName&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">firstName</span><span class="o">,</span> 
    <span class="s">&quot;lastName&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">lastName</span>
  <span class="o">)).</span><span class="n">toFuture</span>
<span class="o">}</span>
</code></pre></div>


<p>Au final, vous aurez :</p>

<div class="highlight"><pre><code class="scala"><span class="k">package</span> <span class="nn">org.k33g.DemoWeb</span>

<span class="k">import</span> <span class="nn">com.twitter.finatra._</span>
<span class="k">import</span> <span class="nn">com.twitter.finatra.ContentType._</span>
<span class="k">import</span> <span class="nn">org.k33g.models._</span>

<span class="k">object</span> <span class="nc">App</span> <span class="k">extends</span> <span class="nc">FinatraServer</span> <span class="o">{</span>

  <span class="k">class</span> <span class="nc">MyApp</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>

    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
      <span class="n">render</span><span class="o">.</span><span class="n">static</span><span class="o">(</span><span class="s">&quot;index.html&quot;</span><span class="o">).</span><span class="n">toFuture</span>
    <span class="o">}</span>

    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/humans/:id&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="n">request</span><span class="o">.</span><span class="n">routeParams</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
      <span class="k">val</span> <span class="n">bob</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Human</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;Morane&quot;</span><span class="o">)</span>

      <span class="n">render</span><span class="o">.</span><span class="n">json</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span>
        <span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">id</span><span class="o">,</span> 
        <span class="s">&quot;firstName&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">firstName</span><span class="o">,</span> 
        <span class="s">&quot;lastName&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">lastName</span>
      <span class="o">)).</span><span class="n">toFuture</span>
    <span class="o">}</span>

  <span class="o">}</span>

  <span class="n">register</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyApp</span><span class="o">())</span>
<span class="o">}</span>
</code></pre></div>


<p>Testez en lançant <code>sbt run</code> et appelez <a href="http://localhost:7070/humans/42">http://localhost:7070/humans/42</a> et vous obtiendrez dans votre navigateur :</p>

<pre><code>{"id":"42","firstName":"Bob","lastName":"Morane"}
</code></pre>

<p><em>Vous pouvez changer l'id dans l'url pour tester</em></p>

<p>Pas trop dur?</p>

<h4>Remarque:</h4>

<p>Pour les faignasses, sachez que vous pouvez remplacer :</p>

<div class="highlight"><pre><code class="scala"><span class="n">render</span><span class="o">.</span><span class="n">json</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span>
  <span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">id</span><span class="o">,</span> 
  <span class="s">&quot;firstName&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">firstName</span><span class="o">,</span> 
  <span class="s">&quot;lastName&quot;</span> <span class="o">-&gt;</span> <span class="n">bob</span><span class="o">.</span><span class="n">lastName</span>
<span class="o">)).</span><span class="n">toFuture</span>
</code></pre></div>


<p>par :</p>

<div class="highlight"><pre><code class="scala"><span class="n">render</span><span class="o">.</span><span class="n">json</span><span class="o">(</span><span class="n">bob</span><span class="o">).</span><span class="n">toFuture</span>
</code></pre></div>


<h3>Utilisation du service json avec Backbone</h3>

<p>Parce qu'une application web sans javascript n'est pas une vraie application web, retournez ouvrir <code>index.html</code> et ajouter le code suivant en vas de page juste avant la fermeture de la balise <code>&lt;body&gt;</code> (donc <code>&lt;/body&gt;</code>) :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;script&gt;</span>

  <span class="kd">var</span> <span class="nx">HumanModel</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">urlRoot</span> <span class="o">:</span> <span class="s2">&quot;humans&quot;</span>
  <span class="p">});</span>      

  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HumanModel</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;42&quot;</span><span class="p">})</span>
    <span class="nx">bob</span><span class="p">.</span><span class="nx">fetch</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;h1&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;firstName&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">bob</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">));</span>
      <span class="p">})</span>
  <span class="p">});</span>

<span class="nt">&lt;/script&gt;</span>
</code></pre></div>


<p>Rafraîchissez votre page, vous allez voir que votre titre se met à jour avec les données du service json.</p>

<h2>Auto-Reload</h2>

<p>Ce qui me plaisez énormément dans Play!>1 (et 2), c'était le rechargement automatique (+compilation) lorsque l'on modifiait le code. Sachez que moyennant une petite "bidouille" ceci est très possible. Il suffit d'ajouter un plugin à <strong>sbt</strong>. Ce plugin est <a href="https://github.com/spray/sbt-revolver">sbt-revolver</a>.</p>

<p>Commencez par quitter la console <strong>sbt</strong> (<code>Ctrl + c</code>). Ensuite dans le répertoire <code>project</code> de votre application, créez un fichier <code>plugins.sbt</code> avec le contenu suivant :</p>

<pre><code>addSbtPlugin("io.spray" % "sbt-revolver" % "0.7.2")
</code></pre>

<p>puis à la racine de votre projet, dans le fichier <code>build.sbt</code> ajoutez la ligne <code>Revolver.settings</code> comme ceci :</p>

<pre><code>name := "DemoWeb"

version := "0.0.1-SNAPSHOT"

scalaVersion := "2.10.3"

libraryDependencies ++= Seq(
  "com.twitter" %% "finatra" % "1.5.2"
)

Revolver.settings

resolvers +=
  "Twitter" at "http://maven.twttr.com"
</code></pre>

<p>Relancez mais avec la commande duivante <code>sbt ~re-start</code> (qui va charger les dépendances nécessaires puis lancer votre application).</p>

<p>Maintenant à chaque fois que vous modifierez le code, <strong>sbt</strong> recompilera et relancera l'application.</p>

<p>Essayez ça par exemple : dans <code>App.scala</code></p>

<div class="highlight"><pre><code class="scala"><span class="n">get</span><span class="o">(</span><span class="s">&quot;/humans&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
  <span class="k">val</span> <span class="n">bob</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Human</span><span class="o">(</span><span class="s">&quot;42&quot;</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;Morane&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">john</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Human</span><span class="o">(</span><span class="s">&quot;00&quot;</span><span class="o">,</span> <span class="s">&quot;John&quot;</span><span class="o">,</span> <span class="s">&quot;Doe&quot;</span><span class="o">)</span>

  <span class="n">render</span><span class="o">.</span><span class="n">json</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">bob</span><span class="o">,</span> <span class="n">john</span><span class="o">)).</span><span class="n">toFuture</span>
<span class="o">}</span>
</code></pre></div>


<p>Sauvegardez, regardez votre console qui compile automatiquement, puis appelez <a href="http://localhost:7070/humans">http://localhost:7070/humans</a> et vous obtenez :</p>

<pre><code>[{"id":"42","firstName":"Bob","lastName":"Morane"},{"id":"00","firstName":"John","lastName":"Doe"}]
</code></pre>

<p>Magique!</p>

<p>Vous avez donc tout ce qu'il faut pour tester un peu tout ça et la prochaine fois on fait la suite des services avec un peu de base de données.</p>

<p>Enjoy! (et bon WE pluvieux)</p>

<p><em>Et encore merci <a href="https://twitter.com/loic_d">@loic_d</a>, j'ai fini par m'y mettre. ;)</em></p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'J'apprends Scala avec Finatra';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>10 May 2014</span> &raquo; <a href="/2014/05/10/ATOM-SHELL.html">Atom-shell, javascript everywhere</a></li>
            
              <li><span>09 May 2014</span> &raquo; <a href="/2014/05/09/NPM-NODE-CLI.html">Faites vos outils avec npm et node</a></li>
            
              <li><span>04 May 2014</span> &raquo; <a href="/2014/05/04/MIXIT-2014.html">MixITFR2014</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>